<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Phan Hoang Long’s Personal Site - Develop &amp; Retain Valuable Airline Customers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Phan Hoang Long’s Personal Site</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-analytics-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Data Analytics Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-analytics-projects">    
        <li>
    <a class="dropdown-item" href="../../Personal_Proj/LISA/Take-Home_Ex1.html" rel="" target="">
 <span class="dropdown-text">Analysis of Geospatial Distribution of Bus Ridership by Origin Bus Stop in Singapore</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Personal_Proj/Fake_News_Detection/fake_news.html" rel="" target="">
 <span class="dropdown-text">Untangling Fact from Falsehood Using NLP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Personal_Proj/airline/airline.html" rel="" target="">
 <span class="dropdown-text">IN PROGRESS Develop &amp; Retain Valuable Airline Customers</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Contact</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#business-problem" id="toc-business-problem" class="nav-link" data-scroll-target="#business-problem">Business Problem</a></li>
  <li><a href="#import-libraries-and-datasets" id="toc-import-libraries-and-datasets" class="nav-link" data-scroll-target="#import-libraries-and-datasets">Import Libraries and Datasets</a>
  <ul class="collapse">
  <li><a href="#load-required-packages" id="toc-load-required-packages" class="nav-link" data-scroll-target="#load-required-packages">Load Required Packages</a></li>
  </ul></li>
  <li><a href="#define-helper-functions-and-constants" id="toc-define-helper-functions-and-constants" class="nav-link" data-scroll-target="#define-helper-functions-and-constants">Define Helper Functions and Constants</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import Data</a>
  <ul class="collapse">
  <li><a href="#loyalty-history" id="toc-loyalty-history" class="nav-link" data-scroll-target="#loyalty-history">Loyalty History</a></li>
  <li><a href="#flight-activity" id="toc-flight-activity" class="nav-link" data-scroll-target="#flight-activity">Flight Activity</a></li>
  </ul></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul class="collapse">
  <li><a href="#preliminary-data-cleaning" id="toc-preliminary-data-cleaning" class="nav-link" data-scroll-target="#preliminary-data-cleaning">Preliminary Data Cleaning</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#customer-distribution" id="toc-customer-distribution" class="nav-link" data-scroll-target="#customer-distribution">Customer Distribution</a></li>
  <li><a href="#potential-impact-of-2018-promotion" id="toc-potential-impact-of-2018-promotion" class="nav-link" data-scroll-target="#potential-impact-of-2018-promotion">Potential Impact of 2018 Promotion</a></li>
  <li><a href="#number-of-enrollment-and-cancellation" id="toc-number-of-enrollment-and-cancellation" class="nav-link" data-scroll-target="#number-of-enrollment-and-cancellation">Number of Enrollment and Cancellation</a></li>
  <li><a href="#churn-customers" id="toc-churn-customers" class="nav-link" data-scroll-target="#churn-customers">Churn Customers</a></li>
  </ul></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing">Hypothesis Testing</a>
  <ul class="collapse">
  <li><a href="#kruskal-wallis-test-for-categorical-features-and-clv" id="toc-kruskal-wallis-test-for-categorical-features-and-clv" class="nav-link" data-scroll-target="#kruskal-wallis-test-for-categorical-features-and-clv">Kruskal-Wallis Test for Categorical Features and CLV</a></li>
  </ul></li>
  <li><a href="#encouraging-additional-expenditure-with-coupon-customer-segmentation" id="toc-encouraging-additional-expenditure-with-coupon-customer-segmentation" class="nav-link" data-scroll-target="#encouraging-additional-expenditure-with-coupon-customer-segmentation">Encouraging Additional Expenditure with Coupon &amp; Customer Segmentation</a>
  <ul class="collapse">
  <li><a href="#defining-the-number-of-clusters" id="toc-defining-the-number-of-clusters" class="nav-link" data-scroll-target="#defining-the-number-of-clusters">Defining the Number of Clusters</a></li>
  <li><a href="#determining-optimal-coupon-values-by-different-segmentation-methods" id="toc-determining-optimal-coupon-values-by-different-segmentation-methods" class="nav-link" data-scroll-target="#determining-optimal-coupon-values-by-different-segmentation-methods">Determining Optimal Coupon Values by different segmentation methods</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Develop &amp; Retain Valuable Airline Customers</h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">August 30, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>This project was done as part of ISSS621: Data Science for Business. The analysis was performed jointly with Duong Thu Huong, Janet Toa Zi Ying, Kylie Tan Jing Yi, Lim Yong Yin, Noel Ng Ser Ying.</p>
<p>Main language/tool: Python</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The airline industry operates in a highly competitive environment where retaining customers and ensuring their loyalty is crucial for sustainable growth. Airlines often offer loyalty programs to incentivise repeated business and cultivate a loyal customer base. However, with a huge volume of customer and flight data available, airlines face the challenge of effectively analysing their customer habits, and thereby segmenting these customers, to tailor marketing strategies and enhance customer experiences.</p>
<p>For this project, we have with an airline dataset from Kaggle which consisted of two files: one contains information regarding the customer’s loyalty, such as their membership tier and their customer lifetime value (CLV) which is based on the total amount that they have spent with the airline thus far. This file consists of 16 variables. The other contains the flight history of these customers from 2017 to 2018 with 10 variables.</p>
</section>
<section id="business-problem" class="level2">
<h2 class="anchored" data-anchor-id="business-problem">Business Problem</h2>
<p>The central business problem is how can we extract value from our members? With this question in mind, we defined two broad objectives:</p>
<ol type="1">
<li>Development, or how to extract more value from existing members</li>
<li>Retention, or how to preserve members &amp; reduce cost of churn</li>
</ol>
<p>How these objectives can be translated into solutions and then into Data Science Tasks can be seen in the diagram below.</p>
<p><img src="images/clipboard-4224624296.png" class="img-fluid"></p>
</section>
<section id="import-libraries-and-datasets" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries-and-datasets">Import Libraries and Datasets</h2>
<section id="load-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="load-required-packages">Load Required Packages</h3>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.gridspec <span class="im">as</span> gridspec</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> colorcet <span class="im">as</span> cc</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime                   <span class="im">import</span> datetime</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats                <span class="im">import</span> pearsonr</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats                <span class="im">import</span> pointbiserialr</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats                <span class="im">import</span> chi2_contingency</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats                <span class="im">import</span> kruskal</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Data processing</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing      <span class="im">import</span> LabelEncoder, OneHotEncoder</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Matrix</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy                      <span class="im">import</span> stats</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine learning</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster            <span class="im">import</span> KMeans, AgglomerativeClustering</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors          <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model       <span class="im">import</span> LogisticRegression</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Imbalanced learning</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling     <span class="im">import</span> SMOTE</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.under_sampling    <span class="im">import</span> RandomUnderSampler</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.pipeline          <span class="im">import</span> make_pipeline</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Model selection and evaluation</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn                    <span class="im">import</span> metrics</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics            <span class="im">import</span> classification_report, accuracy_score, cohen_kappa_score, f1_score, recall_score, precision_score, confusion_matrix, roc_curve</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics            <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection    <span class="im">import</span> train_test_split</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress all warnings</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="define-helper-functions-and-constants" class="level2">
<h2 class="anchored" data-anchor-id="define-helper-functions-and-constants">Define Helper Functions and Constants</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># constant</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>RANDOM_STATE <span class="op">=</span> <span class="dv">42</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate months between 2 dates</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_month_interval(start_time, end_time):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (end_time.year <span class="op">-</span> start_time.year)<span class="op">*</span><span class="dv">12</span> <span class="op">+</span> (end_time.month <span class="op">-</span> start_time.month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cf_matrix_labels(cf_matrix):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    group_names <span class="op">=</span> [<span class="st">'True Negatives'</span>,<span class="st">'False Positives'</span>,<span class="st">'False Negatives'</span>,<span class="st">'True Positives'</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    group_counts <span class="op">=</span> [<span class="st">'</span><span class="sc">{0:0.0f}</span><span class="st">'</span>.<span class="bu">format</span>(value) <span class="cf">for</span> value <span class="kw">in</span> cf_matrix.flatten()]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    group_percentages <span class="op">=</span> [<span class="st">'</span><span class="sc">{0:.2%}</span><span class="st">'</span>.<span class="bu">format</span>(value) <span class="cf">for</span> value <span class="kw">in</span> cf_matrix.flatten()<span class="op">/</span>np.<span class="bu">sum</span>(cf_matrix)]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="ss">f'</span><span class="sc">{</span>v1<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>v2<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>v3<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> v1, v2, v3 <span class="kw">in</span> <span class="bu">zip</span>(group_names,group_counts,group_percentages)]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> np.asarray(labels).reshape(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># customize classification report</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_classification_report(y_true, proba_pred):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    precision, recall, threshold <span class="op">=</span> metrics.precision_recall_curve(y_true, proba_pred)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    report_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'threshold'</span>: threshold,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'precision'</span>: precision[:<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'recall'</span>: recall[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    }).assign(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        f1 <span class="op">=</span> <span class="kw">lambda</span> x: <span class="dv">2</span> <span class="op">*</span> x[<span class="st">'recall'</span>] <span class="op">*</span> x[<span class="st">'precision'</span>] <span class="op">/</span> (x[<span class="st">'recall'</span>] <span class="op">+</span> x[<span class="st">'precision'</span>]),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        f2 <span class="op">=</span> <span class="kw">lambda</span> x: (<span class="dv">5</span> <span class="op">*</span> x[<span class="st">'precision'</span>] <span class="op">*</span> x[<span class="st">'recall'</span>]) <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> x[<span class="st">'precision'</span>] <span class="op">+</span> x[<span class="st">'recall'</span>])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">7</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    plt.plot(report_df[<span class="st">'threshold'</span>], report_df[<span class="st">'precision'</span>], label <span class="op">=</span> <span class="st">'precision'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    plt.plot(report_df[<span class="st">'threshold'</span>], report_df[<span class="st">'recall'</span>], label <span class="op">=</span> <span class="st">'recall'</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.plot(report_df['threshold'], report_df['f1'], '--', color='brown', label = 'f1')</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    plt.plot(report_df[<span class="st">'threshold'</span>], report_df[<span class="st">'f2'</span>], <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'green'</span>, label <span class="op">=</span> <span class="st">'f2'</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'threshold'</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'score'</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">'upper center'</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> report_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">Import Data</h2>
<section id="loyalty-history" class="level3">
<h3 class="anchored" data-anchor-id="loyalty-history">Loyalty History</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>loyalty_df <span class="op">=</span> pd.read_csv(<span class="st">'data/Customer Loyalty History.csv'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>loyalty_df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Index(['Loyalty Number', 'Country', 'Province', 'City', 'Postal Code',
       'Gender', 'Education', 'Salary', 'Marital Status', 'Loyalty Card',
       'CLV', 'Enrollment Type', 'Enrollment Year', 'Enrollment Month',
       'Cancellation Year', 'Cancellation Month'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all space character in column name</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>loyalty_new_cols <span class="op">=</span> [col.replace(<span class="st">' '</span>, <span class="st">''</span>) <span class="cf">for</span> col <span class="kw">in</span> loyalty_df.columns]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>loyalty_df <span class="op">=</span> loyalty_df.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(loyalty_df.columns, loyalty_new_cols)))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>loyalty_df.info()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>loyalty_df.head()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'No. of unique customers:'</span>, loyalty_df[<span class="st">'LoyaltyNumber'</span>].nunique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 16737 entries, 0 to 16736
Data columns (total 16 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   LoyaltyNumber      16737 non-null  int64  
 1   Country            16737 non-null  object 
 2   Province           16737 non-null  object 
 3   City               16737 non-null  object 
 4   PostalCode         16737 non-null  object 
 5   Gender             16737 non-null  object 
 6   Education          16737 non-null  object 
 7   Salary             12499 non-null  float64
 8   MaritalStatus      16737 non-null  object 
 9   LoyaltyCard        16737 non-null  object 
 10  CLV                16737 non-null  float64
 11  EnrollmentType     16737 non-null  object 
 12  EnrollmentYear     16737 non-null  int64  
 13  EnrollmentMonth    16737 non-null  int64  
 14  CancellationYear   2067 non-null   float64
 15  CancellationMonth  2067 non-null   float64
dtypes: float64(4), int64(3), object(9)
memory usage: 2.0+ MB
No. of unique customers: 16737</code></pre>
</div>
</div>
</section>
<section id="flight-activity" class="level3">
<h3 class="anchored" data-anchor-id="flight-activity">Flight Activity</h3>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>flight_df <span class="op">=</span> pd.read_csv(<span class="st">'data/Customer Flight Activity.csv'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>flight_df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Index(['Loyalty Number', 'Year', 'Month', 'Flights Booked',
       'Flights with Companions', 'Total Flights', 'Distance',
       'Points Accumulated', 'Points Redeemed', 'Dollar Cost Points Redeemed'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>flight_new_col <span class="op">=</span> [col.replace(<span class="st">' '</span>,<span class="st">''</span>) <span class="cf">for</span> col <span class="kw">in</span> flight_df.columns]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>flight_df <span class="op">=</span> flight_df.rename(columns <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(flight_df.columns,flight_new_col)))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>flight_df.info()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">' '</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>flight_df.head()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">' '</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'No. of recorded flights: '</span>, <span class="bu">len</span>(flight_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 405624 entries, 0 to 405623
Data columns (total 10 columns):
 #   Column                    Non-Null Count   Dtype  
---  ------                    --------------   -----  
 0   LoyaltyNumber             405624 non-null  int64  
 1   Year                      405624 non-null  int64  
 2   Month                     405624 non-null  int64  
 3   FlightsBooked             405624 non-null  int64  
 4   FlightswithCompanions     405624 non-null  int64  
 5   TotalFlights              405624 non-null  int64  
 6   Distance                  405624 non-null  int64  
 7   PointsAccumulated         405624 non-null  float64
 8   PointsRedeemed            405624 non-null  int64  
 9   DollarCostPointsRedeemed  405624 non-null  int64  
dtypes: float64(1), int64(9)
memory usage: 30.9 MB
 
 
No. of recorded flights:  405624</code></pre>
</div>
</div>
</section>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<section id="preliminary-data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-data-cleaning">Preliminary Data Cleaning</h3>
<section id="loyalty-history-1" class="level4">
<h4 class="anchored" data-anchor-id="loyalty-history-1">Loyalty History</h4>
<p>Summary:</p>
<ul>
<li><p>Convert data type of LoyaltyNumber, CancellationYear, CancellationMonth</p></li>
<li><p>Process salary colunn: consider negative salary as missing values, fill all missing values with 0</p></li>
<li><p>Create 4 columns: EnrollmentDate, EnrollmentYearMonth (YYYY-MM), CancellationDate, CancellationYearMonth (YYYY-MM)</p></li>
<li><p>Create ChurnIndicator</p></li>
</ul>
<section id="correcting-data-type" class="level5">
<h5 class="anchored" data-anchor-id="correcting-data-type">Correcting Data Type</h5>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert data type</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>loyalty_df <span class="op">=</span> loyalty_df.assign(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    LoyaltyNumber <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'LoyaltyNumber'</span>].astype(<span class="bu">str</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    CancellationYear <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'CancellationYear'</span>].astype(<span class="st">'Int64'</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    CancellationMonth <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'CancellationMonth'</span>].astype(<span class="st">'Int64'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-numeric-columns" class="level5">
<h5 class="anchored" data-anchor-id="checking-numeric-columns">Checking Numeric Columns</h5>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>loyalty_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Salary</th>
<th data-quarto-table-cell-role="th">CLV</th>
<th data-quarto-table-cell-role="th">EnrollmentYear</th>
<th data-quarto-table-cell-role="th">EnrollmentMonth</th>
<th data-quarto-table-cell-role="th">CancellationYear</th>
<th data-quarto-table-cell-role="th">CancellationMonth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>12499.000000</td>
<td>16737.000000</td>
<td>16737.000000</td>
<td>16737.000000</td>
<td>2067.0</td>
<td>2067.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>79245.609409</td>
<td>7988.896536</td>
<td>2015.253211</td>
<td>6.669116</td>
<td>2016.503145</td>
<td>6.962748</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>35008.297285</td>
<td>6860.982280</td>
<td>1.979111</td>
<td>3.398958</td>
<td>1.380743</td>
<td>3.455297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-58486.000000</td>
<td>1898.010000</td>
<td>2012.000000</td>
<td>1.000000</td>
<td>2013.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>59246.500000</td>
<td>3980.840000</td>
<td>2014.000000</td>
<td>4.000000</td>
<td>2016.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>73455.000000</td>
<td>5780.180000</td>
<td>2015.000000</td>
<td>7.000000</td>
<td>2017.0</td>
<td>7.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>88517.500000</td>
<td>8940.580000</td>
<td>2017.000000</td>
<td>10.000000</td>
<td>2018.0</td>
<td>10.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>407228.000000</td>
<td>83325.380000</td>
<td>2018.000000</td>
<td>12.000000</td>
<td>2018.0</td>
<td>12.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># records with negative salary</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Number of records with negative salary:'</span>, loyalty_df[loyalty_df[<span class="st">'Salary'</span>].le(<span class="dv">0</span>)].shape[<span class="dv">0</span>])</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>loyalty_df[loyalty_df[<span class="st">'Salary'</span>].le(<span class="dv">0</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of records with negative salary: 20</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LoyaltyNumber</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Province</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">PostalCode</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">EnrollmentType</th>
<th data-quarto-table-cell-role="th">EnrollmentYear</th>
<th data-quarto-table-cell-role="th">EnrollmentMonth</th>
<th data-quarto-table-cell-role="th">CancellationYear</th>
<th data-quarto-table-cell-role="th">CancellationMonth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1082</td>
<td>542976</td>
<td>Canada</td>
<td>Quebec</td>
<td>Montreal</td>
<td>H2Y 4R4</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1894</td>
<td>959977</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Vancouver</td>
<td>V5R 1W3</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2471</td>
<td>232755</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Vancouver</td>
<td>V1E 4R6</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3575</td>
<td>525245</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Victoria</td>
<td>V10 6T5</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3932</td>
<td>603070</td>
<td>Canada</td>
<td>British Columbia</td>
<td>West Vancouver</td>
<td>V6V 8Z3</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4712</td>
<td>491242</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Dawson Creek</td>
<td>U5I 4F1</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6560</td>
<td>115505</td>
<td>Canada</td>
<td>Newfoundland</td>
<td>St. John's</td>
<td>A1C 6H9</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>4</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6570</td>
<td>430398</td>
<td>Canada</td>
<td>Newfoundland</td>
<td>St. John's</td>
<td>A1C 6H9</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7373</td>
<td>152016</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>P1J 8T7</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>2</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8576</td>
<td>194065</td>
<td>Canada</td>
<td>Ontario</td>
<td>Sudbury</td>
<td>M5V 1G5</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>2</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8767</td>
<td>212128</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>P2T 6G3</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>2</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10232</td>
<td>790475</td>
<td>Canada</td>
<td>Ontario</td>
<td>Trenton</td>
<td>K8V 4B2</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>2</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11635</td>
<td>366599</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>M1R 4K3</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>4</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12596</td>
<td>436087</td>
<td>Canada</td>
<td>Quebec</td>
<td>Montreal</td>
<td>H2T 9K8</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>4</td>
<td>2018</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13564</td>
<td>364596</td>
<td>Canada</td>
<td>Quebec</td>
<td>Tremblant</td>
<td>H5Y 2S9</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>4</td>
<td>2018</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14327</td>
<td>239955</td>
<td>Canada</td>
<td>Quebec</td>
<td>Hull</td>
<td>J8Y 3Z5</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14355</td>
<td>347013</td>
<td>Canada</td>
<td>Quebec</td>
<td>Quebec City</td>
<td>G1B 3L5</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>3</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15416</td>
<td>729561</td>
<td>Canada</td>
<td>Quebec</td>
<td>Quebec City</td>
<td>G1B 3L5</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>2</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16431</td>
<td>734647</td>
<td>Canada</td>
<td>Saskatchewan</td>
<td>Regina</td>
<td>S1J 3C5</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>4</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16735</td>
<td>906428</td>
<td>Canada</td>
<td>Yukon</td>
<td>Whitehorse</td>
<td>Y2K 6R0</td>
<td>...</td>
<td>2018 Promotion</td>
<td>2018</td>
<td>4</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
</tbody>
</table>

<p>20 rows × 16 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># records with missing salary</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Number of records with missing salary:'</span>, loyalty_df[<span class="st">'Salary'</span>].isna().<span class="bu">sum</span>(),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'</span><span class="ch">\n</span><span class="st">Percentage of records with missing salary:'</span>, <span class="bu">round</span>(loyalty_df[<span class="st">'Salary'</span>].isna().<span class="bu">sum</span>()<span class="op">*</span><span class="dv">100</span><span class="op">/</span>loyalty_df.shape[<span class="dv">0</span>],<span class="dv">2</span>), <span class="st">'%'</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of records with missing salary: 4238 
Percentage of records with missing salary: 25.32 %</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treat negative salary as missing values, fill all missing salary with 0</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>loyalty_df[<span class="st">'Salary'</span>] <span class="op">=</span> loyalty_df[<span class="st">'Salary'</span>].fillna(<span class="dv">0</span>).where(loyalty_df[<span class="st">'Salary'</span>].gt(<span class="dv">0</span>), <span class="dv">0</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Number of records with salary = 0:'</span>, loyalty_df[<span class="st">'Salary'</span>].eq(<span class="dv">0</span>).<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of records with salary = 0: 4258</code></pre>
</div>
</div>
</section>
<section id="time-column" class="level5">
<h5 class="anchored" data-anchor-id="time-column">Time column</h5>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EnrollmentDate (type: datetime), EnrollmentYearMonth (type: string, format: YYYY-MM)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CancellationDate (type: datetime), CancellationYearMonth (type: string, format: YYYY-MM)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>time_membership <span class="op">=</span> [<span class="st">'Enrollment'</span>, <span class="st">'Cancellation'</span>]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> time_membership: </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    loyalty_df[<span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">Date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        loyalty_df[[<span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">Year'</span>, <span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">Month'</span>]].astype(<span class="st">'Float64'</span>)<span class="op">\</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">Year'</span>: <span class="st">'YEAR'</span>, <span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">Month'</span>: <span class="st">'MONTH'</span>}).assign(DAY<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    loyalty_df[<span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">YearMonth'</span>] <span class="op">=</span> loyalty_df[<span class="ss">f'</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">Date'</span>].dt.strftime(<span class="st">'%Y-%m'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>loyalty_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LoyaltyNumber</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Province</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">PostalCode</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">CancellationMonth</th>
<th data-quarto-table-cell-role="th">EnrollmentDate</th>
<th data-quarto-table-cell-role="th">EnrollmentYearMonth</th>
<th data-quarto-table-cell-role="th">CancellationDate</th>
<th data-quarto-table-cell-role="th">CancellationYearMonth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>480934</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>M2Z 4K1</td>
<td>...</td>
<td>&lt;NA&gt;</td>
<td>2016-02-01</td>
<td>2016-02</td>
<td>NaT</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>549612</td>
<td>Canada</td>
<td>Alberta</td>
<td>Edmonton</td>
<td>T3G 6Y6</td>
<td>...</td>
<td>&lt;NA&gt;</td>
<td>2016-03-01</td>
<td>2016-03</td>
<td>NaT</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>429460</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Vancouver</td>
<td>V6E 3D9</td>
<td>...</td>
<td>1</td>
<td>2014-07-01</td>
<td>2014-07</td>
<td>2018-01-01</td>
<td>2018-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>608370</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>P1W 1K4</td>
<td>...</td>
<td>&lt;NA&gt;</td>
<td>2013-02-01</td>
<td>2013-02</td>
<td>NaT</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>530508</td>
<td>Canada</td>
<td>Quebec</td>
<td>Hull</td>
<td>J8Y 3Z5</td>
<td>...</td>
<td>&lt;NA&gt;</td>
<td>2014-10-01</td>
<td>2014-10</td>
<td>NaT</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 20 columns</p>
</div>
</div>
</div>
</section>
<section id="churn-indicator" class="level5">
<h5 class="anchored" data-anchor-id="churn-indicator">Churn Indicator</h5>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>loyalty_df[<span class="st">'ChurnIndicator'</span>] <span class="op">=</span> np.where(loyalty_df[<span class="st">'CancellationMonth'</span>].isna().eq(<span class="va">False</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>loyalty_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LoyaltyNumber</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Province</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">PostalCode</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">EnrollmentDate</th>
<th data-quarto-table-cell-role="th">EnrollmentYearMonth</th>
<th data-quarto-table-cell-role="th">CancellationDate</th>
<th data-quarto-table-cell-role="th">CancellationYearMonth</th>
<th data-quarto-table-cell-role="th">ChurnIndicator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>480934</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>M2Z 4K1</td>
<td>...</td>
<td>2016-02-01</td>
<td>2016-02</td>
<td>NaT</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>549612</td>
<td>Canada</td>
<td>Alberta</td>
<td>Edmonton</td>
<td>T3G 6Y6</td>
<td>...</td>
<td>2016-03-01</td>
<td>2016-03</td>
<td>NaT</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>429460</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Vancouver</td>
<td>V6E 3D9</td>
<td>...</td>
<td>2014-07-01</td>
<td>2014-07</td>
<td>2018-01-01</td>
<td>2018-01</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>608370</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>P1W 1K4</td>
<td>...</td>
<td>2013-02-01</td>
<td>2013-02</td>
<td>NaT</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>530508</td>
<td>Canada</td>
<td>Quebec</td>
<td>Hull</td>
<td>J8Y 3Z5</td>
<td>...</td>
<td>2014-10-01</td>
<td>2014-10</td>
<td>NaT</td>
<td>NaN</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 21 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="flight-activity-1" class="level4">
<h4 class="anchored" data-anchor-id="flight-activity-1">Flight Activity</h4>
<p>Summary:</p>
<ul>
<li><p>Convert data type of LoyaltyNumber</p></li>
<li><p>Create 2 columns: Date, YearMonth</p></li>
</ul>
<section id="converting-data-type" class="level5">
<h5 class="anchored" data-anchor-id="converting-data-type">Converting Data Type</h5>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>flight_df[<span class="st">'LoyaltyNumber'</span>] <span class="op">=</span> flight_df[<span class="st">'LoyaltyNumber'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-numeric-columns-1" class="level5">
<h5 class="anchored" data-anchor-id="checking-numeric-columns-1">Checking Numeric Columns</h5>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>flight_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">FlightsBooked</th>
<th data-quarto-table-cell-role="th">FlightswithCompanions</th>
<th data-quarto-table-cell-role="th">TotalFlights</th>
<th data-quarto-table-cell-role="th">Distance</th>
<th data-quarto-table-cell-role="th">PointsAccumulated</th>
<th data-quarto-table-cell-role="th">PointsRedeemed</th>
<th data-quarto-table-cell-role="th">DollarCostPointsRedeemed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
<td>405624.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2017.500000</td>
<td>6.500000</td>
<td>4.115052</td>
<td>1.031805</td>
<td>5.146858</td>
<td>1208.880059</td>
<td>123.692721</td>
<td>30.696872</td>
<td>2.484503</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.500001</td>
<td>3.452057</td>
<td>5.225518</td>
<td>2.076869</td>
<td>6.521227</td>
<td>1433.155320</td>
<td>146.599831</td>
<td>125.486049</td>
<td>10.150038</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>2017.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2017.000000</td>
<td>3.750000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>2017.500000</td>
<td>6.500000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>488.000000</td>
<td>50.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2018.000000</td>
<td>9.250000</td>
<td>8.000000</td>
<td>1.000000</td>
<td>10.000000</td>
<td>2336.000000</td>
<td>239.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>2018.000000</td>
<td>12.000000</td>
<td>21.000000</td>
<td>11.000000</td>
<td>32.000000</td>
<td>6293.000000</td>
<td>676.500000</td>
<td>876.000000</td>
<td>71.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>From a cursory look, there does not seem to be any abnormality.</p>
</section>
<section id="time-column-1" class="level5">
<h5 class="anchored" data-anchor-id="time-column-1">Time Column</h5>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>flight_df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(flight_df[[<span class="st">'Year'</span>, <span class="st">'Month'</span>]].assign(DAY<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>flight_df[<span class="st">'YearMonth'</span>] <span class="op">=</span> flight_df[<span class="st">'Date'</span>].dt.strftime(<span class="st">'%Y-%m'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h3>
<section id="customer-level" class="level4">
<h4 class="anchored" data-anchor-id="customer-level">Customer Level</h4>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of months of membership</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>loyalty_df <span class="op">=</span> loyalty_df.assign(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    ObservationDate <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'CancellationDate'</span>].where(x[<span class="st">'CancellationDate'</span>].isna().eq(<span class="va">False</span>), flight_df[<span class="st">'Date'</span>].<span class="bu">max</span>()),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    MonthsOfMembership <span class="op">=</span> <span class="kw">lambda</span> x: x.<span class="bu">apply</span>(<span class="kw">lambda</span> z: calculate_month_interval(z[<span class="st">'EnrollmentDate'</span>], z[<span class="st">'ObservationDate'</span>]), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>).drop(columns<span class="op">=</span><span class="st">'ObservationDate'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregation on flight activity (sum)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>flight_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> flight_df.columns <span class="cf">if</span> flight_df[col].dtype <span class="kw">in</span> [<span class="st">'int64'</span>, <span class="st">'float64'</span>]][<span class="dv">2</span>:]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>temp_total_flight <span class="op">=</span> flight_df.groupby(by<span class="op">=</span><span class="st">'LoyaltyNumber'</span>, sort<span class="op">=</span><span class="va">False</span>)[flight_cols].<span class="bu">sum</span>()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>temp_total_flight.columns <span class="op">=</span> [<span class="ss">f'Total</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> flight_cols]</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>temp_total_flight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TotalFlightsBooked</th>
<th data-quarto-table-cell-role="th">TotalFlightswithCompanions</th>
<th data-quarto-table-cell-role="th">TotalTotalFlights</th>
<th data-quarto-table-cell-role="th">TotalDistance</th>
<th data-quarto-table-cell-role="th">TotalPointsAccumulated</th>
<th data-quarto-table-cell-role="th">TotalPointsRedeemed</th>
<th data-quarto-table-cell-role="th">TotalDollarCostPointsRedeemed</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">LoyaltyNumber</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">100018</td>
<td>157</td>
<td>35</td>
<td>192</td>
<td>50682</td>
<td>5376.00</td>
<td>1513</td>
<td>123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100102</td>
<td>173</td>
<td>42</td>
<td>215</td>
<td>40222</td>
<td>4115.25</td>
<td>1195</td>
<td>96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100140</td>
<td>152</td>
<td>38</td>
<td>190</td>
<td>41252</td>
<td>4184.25</td>
<td>593</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100214</td>
<td>79</td>
<td>17</td>
<td>96</td>
<td>33982</td>
<td>3426.00</td>
<td>861</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100272</td>
<td>127</td>
<td>36</td>
<td>163</td>
<td>40872</td>
<td>4108.04</td>
<td>1007</td>
<td>82</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">998972</td>
<td>80</td>
<td>24</td>
<td>104</td>
<td>31676</td>
<td>3164.00</td>
<td>2201</td>
<td>178</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999304</td>
<td>46</td>
<td>5</td>
<td>51</td>
<td>10662</td>
<td>1065.00</td>
<td>809</td>
<td>65</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999731</td>
<td>57</td>
<td>16</td>
<td>73</td>
<td>15598</td>
<td>1555.00</td>
<td>407</td>
<td>33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999788</td>
<td>42</td>
<td>16</td>
<td>58</td>
<td>15784</td>
<td>1575.00</td>
<td>361</td>
<td>29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999891</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>2526</td>
<td>252.00</td>
<td>414</td>
<td>34</td>
</tr>
</tbody>
</table>

<p>16737 rows × 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage of Redeemed Points / Accumulated Points</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>temp_total_flight[<span class="st">'PercentagePointsRedeemed'</span>] <span class="op">=</span> temp_total_flight[<span class="st">'TotalPointsRedeemed'</span>].where(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    temp_total_flight[<span class="st">'TotalPointsRedeemed'</span>].eq(<span class="dv">0</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    temp_total_flight[<span class="st">'TotalPointsRedeemed'</span>].div(temp_total_flight[<span class="st">'TotalPointsAccumulated'</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>temp_total_flight[<span class="st">'PercentagePointsRedeemed'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>count    16737.000000
mean         0.231936
std          0.277969
min          0.000000
25%          0.000000
50%          0.190000
75%          0.350000
max          5.200000
Name: PercentagePointsRedeemed, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregation on flight activity (Monthly average)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>temp_monthly_flight <span class="op">=</span> temp_total_flight[[<span class="st">'TotalTotalFlights'</span>, <span class="st">'TotalPointsAccumulated'</span>]].merge(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    loyalty_df[[<span class="st">'LoyaltyNumber'</span>, <span class="st">'MonthsOfMembership'</span>]].set_index(<span class="st">'LoyaltyNumber'</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>).assign(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    MonthlyTotalFlights <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'MonthsOfMembership'</span>].where(x[<span class="st">'MonthsOfMembership'</span>].eq(<span class="dv">0</span>), </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                                                                  x[<span class="st">'TotalTotalFlights'</span>].div(x[<span class="st">'MonthsOfMembership'</span>]).<span class="bu">round</span>(<span class="dv">2</span>)), </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    MonthlyPointsAccumulated <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'MonthsOfMembership'</span>].where(x[<span class="st">'MonthsOfMembership'</span>].eq(<span class="dv">0</span>), </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>                                                                       x[<span class="st">'TotalPointsAccumulated'</span>].div(x[<span class="st">'MonthsOfMembership'</span>]).<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>).iloc[:, <span class="dv">3</span>:]</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>temp_monthly_flight.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MonthlyTotalFlights</th>
<th data-quarto-table-cell-role="th">MonthlyPointsAccumulated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>16737.000000</td>
<td>16737.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.160505</td>
<td>123.283008</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>9.252993</td>
<td>221.768018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.430000</td>
<td>58.880000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>3.790000</td>
<td>91.390000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>6.250000</td>
<td>150.720000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>223.000000</td>
<td>5176.500000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Merge all feature sets to loyalty_df</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>loyalty_df <span class="op">=</span> loyalty_df.merge(temp_total_flight.reset_index(), how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'LoyaltyNumber'</span>)<span class="op">\</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    .merge(temp_monthly_flight.reset_index(), how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'LoyaltyNumber'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>loyalty_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LoyaltyNumber</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Province</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">PostalCode</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">TotalPointsRedeemed</th>
<th data-quarto-table-cell-role="th">TotalDollarCostPointsRedeemed</th>
<th data-quarto-table-cell-role="th">PercentagePointsRedeemed</th>
<th data-quarto-table-cell-role="th">MonthlyTotalFlights</th>
<th data-quarto-table-cell-role="th">MonthlyPointsAccumulated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>480934</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>M2Z 4K1</td>
<td>...</td>
<td>1418</td>
<td>115</td>
<td>0.27</td>
<td>5.03</td>
<td>153.66</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>549612</td>
<td>Canada</td>
<td>Alberta</td>
<td>Edmonton</td>
<td>T3G 6Y6</td>
<td>...</td>
<td>1971</td>
<td>159</td>
<td>0.47</td>
<td>6.52</td>
<td>126.55</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>429460</td>
<td>Canada</td>
<td>British Columbia</td>
<td>Vancouver</td>
<td>V6E 3D9</td>
<td>...</td>
<td>374</td>
<td>30</td>
<td>0.19</td>
<td>2.07</td>
<td>46.74</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>608370</td>
<td>Canada</td>
<td>Ontario</td>
<td>Toronto</td>
<td>P1W 1K4</td>
<td>...</td>
<td>1291</td>
<td>105</td>
<td>0.36</td>
<td>2.27</td>
<td>51.81</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>530508</td>
<td>Canada</td>
<td>Quebec</td>
<td>Hull</td>
<td>J8Y 3Z5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>3.52</td>
<td>73.79</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
</section>
<section id="flight-level" class="level4">
<h4 class="anchored" data-anchor-id="flight-level">Flight Level</h4>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>flight_df <span class="op">=</span> flight_df.sort_values(by<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'LoyaltyNumber'</span>])<span class="co">#.set_index('LoyaltyNumber')</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>TIME_INDEX <span class="op">=</span> pd.DatetimeIndex(flight_df[<span class="st">'Date'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregation of flight stats for 1 year, 6 months, 3 months and 1 month lookback</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>lookback_period <span class="op">=</span> {</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1Y'</span>: <span class="st">'366D'</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6M'</span>: <span class="st">'183D'</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3M'</span>: <span class="st">'93D'</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1M'</span>: <span class="st">'31D'</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>temp_lookback_flight_dfs <span class="op">=</span> []</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> last, day <span class="kw">in</span> lookback_period.items():</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> flight_df.groupby(by<span class="op">=</span><span class="st">'LoyaltyNumber'</span>, sort<span class="op">=</span><span class="va">False</span>)[flight_cols]<span class="op">\</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        .rolling(window<span class="op">=</span>day, on<span class="op">=</span>TIME_INDEX, closed<span class="op">=</span><span class="st">'left'</span>).<span class="bu">sum</span>()<span class="op">\</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        .reset_index().sort_values(by<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'LoyaltyNumber'</span>])<span class="op">\</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        .drop(columns<span class="op">=</span><span class="st">'level_1'</span>).set_index([<span class="st">'LoyaltyNumber'</span>, <span class="st">'Date'</span>])</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="ss">f'Last</span><span class="sc">{</span>last<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> col <span class="kw">in</span> flight_cols]</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    temp_lookback_flight_dfs.append(df)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>lookback_flight_df <span class="op">=</span> flight_df[[<span class="st">'LoyaltyNumber'</span>, <span class="st">'Date'</span>]]</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> temp_lookback_flight_dfs:</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    lookback_flight_df <span class="op">=</span> lookback_flight_df.merge(df.reset_index(), how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'LoyaltyNumber'</span>, <span class="st">'Date'</span>])</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>lookback_flight_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LoyaltyNumber</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Last1Y_FlightsBooked</th>
<th data-quarto-table-cell-role="th">Last1Y_FlightswithCompanions</th>
<th data-quarto-table-cell-role="th">Last1Y_TotalFlights</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Last1M_TotalFlights</th>
<th data-quarto-table-cell-role="th">Last1M_Distance</th>
<th data-quarto-table-cell-role="th">Last1M_PointsAccumulated</th>
<th data-quarto-table-cell-role="th">Last1M_PointsRedeemed</th>
<th data-quarto-table-cell-role="th">Last1M_DollarCostPointsRedeemed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100018</td>
<td>2017-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100102</td>
<td>2017-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100140</td>
<td>2017-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100214</td>
<td>2017-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100272</td>
<td>2017-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">528019</td>
<td>999902</td>
<td>2018-12-01</td>
<td>87.0</td>
<td>15.0</td>
<td>102.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">528020</td>
<td>999911</td>
<td>2018-12-01</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">528021</td>
<td>999940</td>
<td>2018-12-01</td>
<td>51.0</td>
<td>18.0</td>
<td>69.0</td>
<td>...</td>
<td>17.0</td>
<td>3859.0</td>
<td>385.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">528022</td>
<td>999982</td>
<td>2018-12-01</td>
<td>22.0</td>
<td>2.0</td>
<td>24.0</td>
<td>...</td>
<td>3.0</td>
<td>1560.0</td>
<td>156.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">528023</td>
<td>999986</td>
<td>2018-12-01</td>
<td>49.0</td>
<td>10.0</td>
<td>59.0</td>
<td>...</td>
<td>15.0</td>
<td>2040.0</td>
<td>204.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>528024 rows × 30 columns</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<section id="customer-distribution" class="level3">
<h3 class="anchored" data-anchor-id="customer-distribution">Customer Distribution</h3>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df <span class="op">=</span> loyalty_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm that dataset only contains Canadian customers</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df[<span class="st">"Country"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>Country
Canada    16737
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Set churn indicator as categorical data</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df[<span class="st">'ChurnIndicator'</span>] <span class="op">=</span> cust_eda_loyalty_df[<span class="st">'ChurnIndicator'</span>].astype(<span class="st">"category"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>flights_summary <span class="op">=</span> cust_eda_loyalty_df.groupby(<span class="st">'MaritalStatus'</span>).agg( {<span class="st">'TotalTotalFlights'</span>:[<span class="st">'sum'</span>], <span class="st">'TotalFlightswithCompanions'</span>: [<span class="st">'sum'</span>]}).reset_index()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the percentage of flights with companions</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>flights_summary[<span class="st">'PercentageWithCompanions'</span>] <span class="op">=</span> (flights_summary[<span class="st">'TotalFlightswithCompanions'</span>] <span class="op">/</span> flights_summary[<span class="st">'TotalTotalFlights'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary DataFrame</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(flights_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MaritalStatus TotalTotalFlights TotalFlightswithCompanions  \
                              sum                        sum   
0      Divorced            311069                      62289   
1       Married           1213745                     243295   
2        Single            562875                     112941   

  PercentageWithCompanions  
                            
0                20.024175  
1                20.044985  
2                20.065023  </code></pre>
</div>
</div>
<section id="salary-distribution" class="level4">
<h4 class="anchored" data-anchor-id="salary-distribution">Salary Distribution</h4>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">9</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, y<span class="op">=</span><span class="st">'Salary'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Salary Distribution'</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Salary'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-34-output-1.png" width="544" height="709"></p>
</div>
</div>
</section>
<section id="gender-distribution" class="level4">
<h4 class="anchored" data-anchor-id="gender-distribution">Gender Distribution</h4>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check distribution by gender</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">'Gender'</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> <span class="st">'Gender'</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [<span class="st">"Female"</span>,<span class="st">"Male"</span>]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total flights booked by gender</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>total_flights <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'TotalTotalFlights'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>total_flights.Gender <span class="op">=</span> total_flights.Gender.astype(<span class="st">"category"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>total_flights.Gender <span class="op">=</span> total_flights.Gender.cat.set_categories(order)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>total_flights.sort_values([x])</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of churned customers by education level</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>churn_proportions <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'ChurnIndicator'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>churn_proportions.columns <span class="op">=</span> [<span class="st">'Not Churn'</span>, <span class="st">'Churn'</span>]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Not Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>churn_proportions.sort_values(<span class="st">'Churn'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on months of membership between 0 to 12 months</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> cust_eda_loyalty_df[(loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)]</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>mom12[x] <span class="op">=</span> pd.Categorical(mom12[x], categories<span class="op">=</span>order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> mom12.sort_values(x)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom colour mapping to each gender</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>colour <span class="op">=</span>  {<span class="st">'Female'</span>: <span class="st">'salmon'</span>, <span class="st">'Male'</span>: <span class="st">'skyblue'</span>}</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot area</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> rows, ncols <span class="op">=</span> cols, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">1</span>)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Customers by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">2</span>)</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'Salary'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Salary by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Salary'</span>)</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">3</span>)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'CLV'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of CLV by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'CLV'</span>)</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">4</span>)</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Membership Length (Months) by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Membership Length (Months)'</span>)</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">5</span>)</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightsBooked'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Individual Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Individual Flights Booked'</span>)</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">6</span>)</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightswithCompanions'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Flights with Companions by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights with Companions Flights Booked'</span>)</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">7</span>)</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalTotalFlights'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights Booked'</span>)</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">8</span>)</span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalDistance'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>colour)</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Distance Travelled by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Distance'</span>)</span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">9</span>)</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'PercentagePointsRedeemed'</span>, hue<span class="op">=</span>x, order<span class="op">=</span>order, palette<span class="op">=</span>colour)</span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Points Redeemed by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Points Redeemed (%)'</span>)</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">10</span>)</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span><span class="st">'ChurnIndicator'</span>, palette<span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Churn Frequency'</span>)</span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Churn Indicator'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>churn_proportions.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax <span class="op">=</span> axs[<span class="dv">3</span>,<span class="dv">1</span>], color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'mediumseagreen'</span>])</span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].<span class="bu">set</span>(title <span class="op">=</span> <span class="ss">f'Proportion of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a>             xlabel <span class="op">=</span> label,</span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a>             ylabel <span class="op">=</span> <span class="st">'Churn Proportion (%)'</span>)</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].set_xticklabels(axs[<span class="dv">3</span>,<span class="dv">1</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> gridspec.GridSpec(rows, cols, figure<span class="op">=</span>fig)</span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>ax_big <span class="op">=</span> fig.add_subplot(gs[<span class="dv">4</span>, <span class="dv">0</span>:])</span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>mom12, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x, ax<span class="op">=</span>ax_big, palette<span class="op">=</span>colour)</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a>ax_big.<span class="bu">set</span>(title<span class="op">=</span><span class="ss">f'Count of Months of Membership by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>           xlabel<span class="op">=</span><span class="st">"Months of Membership"</span>,</span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a>           ylabel<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-35-output-1.png" width="1909" height="2388"></p>
</div>
</div>
</section>
<section id="education-distribution" class="level4">
<h4 class="anchored" data-anchor-id="education-distribution">Education Distribution</h4>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check distribution by education</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">'Education'</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> <span class="st">'Education Level'</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [<span class="st">"Doctor"</span>, <span class="st">"Master"</span>, <span class="st">"Bachelor"</span>, <span class="st">"College"</span>, <span class="st">"High School or Below"</span>]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total flights booked by education level</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>total_flights <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'TotalTotalFlights'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>total_flights.Education <span class="op">=</span> total_flights.Education.astype(<span class="st">"category"</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>total_flights.Education <span class="op">=</span> total_flights.Education.cat.set_categories(order)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>total_flights.sort_values([x])</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort education level in cust_eda_loyalty_df in descending order</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df.Education <span class="op">=</span> cust_eda_loyalty_df.Education.astype(<span class="st">"category"</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df.Education <span class="op">=</span> cust_eda_loyalty_df.Education.cat.set_categories(order)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df.sort_values([x])</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of churned customers by education level</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>churn_proportions <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'ChurnIndicator'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>churn_proportions.columns <span class="op">=</span> [<span class="st">'Not Churn'</span>, <span class="st">'Churn'</span>]</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Not Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>churn_proportions.sort_values(<span class="st">'Churn'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on months of membership between 0 to 12 months</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> cust_eda_loyalty_df[(cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)]</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>mom12[x] <span class="op">=</span> pd.Categorical(mom12[x], categories<span class="op">=</span>order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> mom12.sort_values(x)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot area</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> rows, ncols <span class="op">=</span> cols, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">1</span>)</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span>x)</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Customers by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">2</span>)</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'Salary'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Salary by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Salary'</span>)</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">3</span>)</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'CLV'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of CLV by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'CLV'</span>)</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">4</span>)</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Membership Length (Months) by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Membership Length (Months)'</span>)</span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">5</span>)</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightsBooked'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Individual Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Individual Flights Booked'</span>)</span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">6</span>)</span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightswithCompanions'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Flights with Companions by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights with Companions Flights Booked'</span>)</span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">7</span>)</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalTotalFlights'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights Booked'</span>)</span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">8</span>)</span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalDistance'</span>, hue<span class="op">=</span>x)</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Distance Travelled by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Distance'</span>)</span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">9</span>)</span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'PercentagePointsRedeemed'</span>, hue<span class="op">=</span>x, order<span class="op">=</span>order)</span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Points Redeemed by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Points Redeemed (%)'</span>)</span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">10</span>)</span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span><span class="st">'ChurnIndicator'</span>, palette<span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Churn Frequency'</span>)</span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Churn Indicator'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a>churn_proportions.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax <span class="op">=</span> axs[<span class="dv">3</span>,<span class="dv">1</span>], color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'mediumseagreen'</span>])</span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].<span class="bu">set</span>(title <span class="op">=</span> <span class="ss">f'Proportion of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>             xlabel <span class="op">=</span> label,</span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a>             ylabel <span class="op">=</span> <span class="st">'Churn Proportion (%)'</span>)</span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].set_xticklabels(axs[<span class="dv">3</span>,<span class="dv">1</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> gridspec.GridSpec(rows, cols, figure<span class="op">=</span>fig)</span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a>ax_big <span class="op">=</span> fig.add_subplot(gs[<span class="dv">4</span>, <span class="dv">0</span>:])</span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>mom12, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x, ax<span class="op">=</span>ax_big)</span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a>ax_big.<span class="bu">set</span>(title<span class="op">=</span><span class="ss">f'Count of Months of Membership by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a>           xlabel<span class="op">=</span><span class="st">"Months of Membership"</span>,</span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a>           ylabel<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-36-output-1.png" width="1901" height="2388"></p>
</div>
</div>
</section>
<section id="loyalty-card-distribution" class="level4">
<h4 class="anchored" data-anchor-id="loyalty-card-distribution">Loyalty Card Distribution</h4>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check distribution by loyalty card type</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">'LoyaltyCard'</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> <span class="st">"Loyalty Card"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [<span class="st">"Star"</span>, <span class="st">"Nova"</span>, <span class="st">"Aurora"</span>]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total flights booked by loyalty card type</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>total_flights <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'TotalTotalFlights'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>total_flights.LoyaltyCard <span class="op">=</span> total_flights.LoyaltyCard.astype(<span class="st">"category"</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>total_flights.LoyaltyCard <span class="op">=</span> total_flights.LoyaltyCard.cat.set_categories(order)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>total_flights.sort_values([x])</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of churned customers by loyalty card type</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>churn_proportions <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'ChurnIndicator'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>churn_proportions.columns <span class="op">=</span> [<span class="st">'Not Churn'</span>, <span class="st">'Churn'</span>]</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Not Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>churn_proportions.sort_values(<span class="st">'Churn'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on months of membership between 0 to 12 months</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> cust_eda_loyalty_df[(cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)]</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>mom12[x] <span class="op">=</span> pd.Categorical(mom12[x], categories<span class="op">=</span>order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> mom12.sort_values(x)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot area</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> rows, ncols <span class="op">=</span> cols, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">1</span>)</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span>x)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Customers by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">2</span>)</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'Salary'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Salary by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Salary'</span>)</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">3</span>)</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'CLV'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of CLV by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'CLV'</span>)</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">4</span>)</span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Membership Length (Months) by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Membership Length (Months)'</span>)</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">5</span>)</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightsBooked'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Individual Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Individual Flights Booked'</span>)</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">6</span>)</span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightswithCompanions'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Flights with Companions by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights with Companions Flights Booked'</span>)</span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">7</span>)</span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalTotalFlights'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights Booked'</span>)</span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">8</span>)</span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalDistance'</span>, hue<span class="op">=</span>x)</span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Distance Travelled by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Distance'</span>)</span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">9</span>)</span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'PercentagePointsRedeemed'</span>, hue<span class="op">=</span>x, order<span class="op">=</span>order)</span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Points Redeemed by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Points Redeemed (%)'</span>)</span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">10</span>)</span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span><span class="st">'ChurnIndicator'</span>, palette<span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Churn Frequency'</span>)</span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Churn Indicator'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a>churn_proportions.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax <span class="op">=</span> axs[<span class="dv">3</span>,<span class="dv">1</span>], color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'mediumseagreen'</span>])</span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].<span class="bu">set</span>(title <span class="op">=</span> <span class="ss">f'Proportion of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a>             xlabel <span class="op">=</span> label,</span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a>             ylabel <span class="op">=</span> <span class="st">'Churn Proportion (%)'</span>)</span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].set_xticklabels(axs[<span class="dv">3</span>,<span class="dv">1</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> gridspec.GridSpec(rows, cols, figure<span class="op">=</span>fig)</span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a>ax_big <span class="op">=</span> fig.add_subplot(gs[<span class="dv">4</span>, <span class="dv">0</span>:])</span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>mom12, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x, ax<span class="op">=</span>ax_big)</span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a>ax_big.<span class="bu">set</span>(title<span class="op">=</span><span class="ss">f'Count of Months of Membership by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a>           xlabel<span class="op">=</span><span class="st">"Months of Membership"</span>,</span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a>           ylabel<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-37-output-1.png" width="1909" height="2388"></p>
</div>
</div>
</section>
<section id="city-distribution" class="level4">
<h4 class="anchored" data-anchor-id="city-distribution">City Distribution</h4>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check distribution by city</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">'City'</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> <span class="st">"City"</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new df to sort in descending order of median of CLV</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>median_clv_df <span class="op">=</span> loyalty_df.copy()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>median_clv_df[<span class="st">"City"</span>] <span class="op">=</span> pd.Categorical(median_clv_df[<span class="st">"City"</span>], categories<span class="op">=</span>median_clv_df.groupby(<span class="st">"City"</span>)[<span class="st">'CLV'</span>].median().sort_values(ascending<span class="op">=</span><span class="va">False</span>).index, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate frequency of each city and sort in descending order</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>city_counts <span class="op">=</span> cust_eda_loyalty_df[x].value_counts().reset_index()</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>city_counts.columns <span class="op">=</span> [x, <span class="st">'Count'</span>]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>city_counts <span class="op">=</span> city_counts.sort_values(<span class="st">'Count'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> city_counts[x].to_list()</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort city in cust_eda_loyalty_df in descending order of frequency</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df[<span class="st">'City'</span>] <span class="op">=</span> pd.Categorical(cust_eda_loyalty_df[<span class="st">'City'</span>], categories<span class="op">=</span>order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>cust_eda_loyalty_df <span class="op">=</span> cust_eda_loyalty_df.sort_values(<span class="st">'City'</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total flights booked by each city</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>total_flights <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'TotalTotalFlights'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>total_flights.City <span class="op">=</span> total_flights.City.astype(<span class="st">"category"</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>total_flights.City <span class="op">=</span> total_flights.City.cat.set_categories(order)</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>total_flights.sort_values([x])</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of churned customers by city</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>churn_proportions <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'ChurnIndicator'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>churn_proportions.columns <span class="op">=</span> [<span class="st">'Not Churn'</span>, <span class="st">'Churn'</span>]</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Not Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>churn_proportions.sort_values(<span class="st">'Churn'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on months of membership between 0 to 12 months</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> cust_eda_loyalty_df[(cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)]</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>mom12[x] <span class="op">=</span> pd.Categorical(mom12[x], categories<span class="op">=</span>order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> mom12.sort_values(x)</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom colour mapping to each city</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> cc.cm.glasbey_dark</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>colour <span class="op">=</span> [cc.cm.glasbey_dark(i <span class="op">/</span> <span class="bu">len</span>(cust_eda_loyalty_df[<span class="st">"City"</span>])) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cust_eda_loyalty_df[<span class="st">"City"</span>]))]</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>col_map <span class="op">=</span> {city: col <span class="cf">for</span> city, col <span class="kw">in</span> <span class="bu">zip</span>(cust_eda_loyalty_df[<span class="st">'City'</span>], colour)}</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot area</span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> rows, ncols <span class="op">=</span> cols, figsize<span class="op">=</span>(<span class="dv">30</span>,<span class="dv">40</span>))</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">1</span>)</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Customers by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">2</span>)</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'Salary'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Salary by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Salary'</span>)</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">3</span>)</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>median_clv_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'CLV'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of CLV by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'CLV'</span>)</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">4</span>)</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Membership Length (Months) by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Membership Length (Months)'</span>)</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">5</span>)</span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightsBooked'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Individual Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Individual Flights Booked'</span>)</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">6</span>)</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightswithCompanions'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Flights with Companions by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights with Companions Flights Booked'</span>)</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">7</span>)</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalTotalFlights'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights Booked'</span>)</span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">8</span>)</span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalDistance'</span>, hue<span class="op">=</span>x, palette<span class="op">=</span>col_map)</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Distance Travelled by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Distance'</span>)</span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">9</span>)</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'PercentagePointsRedeemed'</span>, hue<span class="op">=</span>x, order<span class="op">=</span>order, palette<span class="op">=</span>col_map)</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Points Redeemed by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Points Redeemed (%)'</span>)</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">10</span>)</span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span><span class="st">'ChurnIndicator'</span>, palette<span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Churn Frequency'</span>)</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Churn Indicator'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a>churn_proportions.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax <span class="op">=</span> axs[<span class="dv">3</span>,<span class="dv">1</span>], color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'mediumseagreen'</span>])</span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].<span class="bu">set</span>(title <span class="op">=</span> <span class="ss">f'Proportion of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a>             xlabel <span class="op">=</span> label,</span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a>             ylabel <span class="op">=</span> <span class="st">'Churn Proportion (%)'</span>)</span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].set_xticklabels(axs[<span class="dv">3</span>,<span class="dv">1</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> gridspec.GridSpec(rows, cols, figure<span class="op">=</span>fig)</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a>ax_big <span class="op">=</span> fig.add_subplot(gs[<span class="dv">4</span>, <span class="dv">0</span>:])</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>mom12, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x, ax<span class="op">=</span>ax_big, palette<span class="op">=</span>col_map)</span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a>ax_big.<span class="bu">set</span>(title<span class="op">=</span><span class="ss">f'Count of Months of Membership by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a>           xlabel<span class="op">=</span><span class="st">"Months of Membership"</span>,</span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a>           ylabel<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-38-output-1.png" width="2866" height="3828"></p>
</div>
</div>
</section>
<section id="enrollment-type-distribution" class="level4">
<h4 class="anchored" data-anchor-id="enrollment-type-distribution">Enrollment Type Distribution</h4>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution by Enrollment Type</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">'EnrollmentType'</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> <span class="st">"Enrollment Type"</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> [<span class="st">"Standard"</span>,<span class="st">"2018 Promotion"</span>]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">3</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total flights booked by enrollment type</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>total_flights <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'TotalTotalFlights'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>total_flights.EnrollmentType <span class="op">=</span> total_flights.EnrollmentType.astype(<span class="st">"category"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>total_flights.EnrollmentType <span class="op">=</span> total_flights.EnrollmentType.cat.set_categories(order)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>total_flights.sort_values([x])</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of churned customers by enrollment type</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>churn_proportions <span class="op">=</span> cust_eda_loyalty_df.groupby(x)[<span class="st">'ChurnIndicator'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>churn_proportions.columns <span class="op">=</span> [<span class="st">'Not Churn'</span>, <span class="st">'Churn'</span>]</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Not Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>churn_proportions[<span class="st">'Churn'</span>] <span class="op">*=</span> <span class="dv">100</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>churn_proportions.sort_values(<span class="st">'Churn'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on months of membership between 0 to 12 months</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> cust_eda_loyalty_df[(cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> (cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)]</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>mom12[x] <span class="op">=</span> pd.Categorical(mom12[x], categories<span class="op">=</span>order, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>mom12 <span class="op">=</span> mom12.sort_values(x)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot area</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> rows, ncols <span class="op">=</span> cols, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">1</span>)</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span>x)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Customers by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">2</span>)</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'Salary'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Salary by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Salary'</span>)</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">3</span>)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'CLV'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of CLV by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'CLV'</span>)</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">4</span>)</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Membership Length (Months) by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Membership Length (Months)'</span>)</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">5</span>)</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightsBooked'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Individual Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Individual Flights Booked'</span>)</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">6</span>)</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalFlightswithCompanions'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Flights with Companions by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights with Companions Flights Booked'</span>)</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">7</span>)</span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalTotalFlights'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Flights by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Flights Booked'</span>)</span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">8</span>)</span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'TotalDistance'</span>, hue<span class="op">=</span>x)</span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Total Distance Travelled by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Distance'</span>)</span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">9</span>)</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, y<span class="op">=</span><span class="st">'PercentagePointsRedeemed'</span>, hue<span class="op">=</span>x, order<span class="op">=</span>order)</span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Distribution of Points Redeemed by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Points Redeemed (%)'</span>)</span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a>plt.legend([], [], frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a>plt.subplot(rows, cols, <span class="dv">10</span>)</span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span>x, hue<span class="op">=</span><span class="st">'ChurnIndicator'</span>, palette<span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Frequency of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a>plt.xlabel(label)</span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Churn Frequency'</span>)</span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Churn Indicator'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a>churn_proportions.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax <span class="op">=</span> axs[<span class="dv">3</span>,<span class="dv">1</span>], color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'mediumseagreen'</span>])</span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].<span class="bu">set</span>(title <span class="op">=</span> <span class="ss">f'Proportion of Churn by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a>             xlabel <span class="op">=</span> label,</span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a>             ylabel <span class="op">=</span> <span class="st">'Churn Proportion (%)'</span>)</span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">1</span>].set_xticklabels(axs[<span class="dv">3</span>,<span class="dv">1</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> gridspec.GridSpec(rows, cols, figure<span class="op">=</span>fig)</span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a>ax_big <span class="op">=</span> fig.add_subplot(gs[<span class="dv">4</span>, <span class="dv">0</span>:])</span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>mom12, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, hue<span class="op">=</span><span class="st">'EnrollmentType'</span>, ax<span class="op">=</span>ax_big)</span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>ax_big.<span class="bu">set</span>(title<span class="op">=</span><span class="ss">f'Count of Months of Membership by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a>           xlabel<span class="op">=</span><span class="st">"Months of Membership"</span>,</span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a>           ylabel<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">3</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">4</span>,<span class="dv">2</span>].set_axis_off()</span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-39-output-1.png" width="1909" height="2388"></p>
</div>
</div>
</section>
<section id="clv-distribution" class="level4">
<h4 class="anchored" data-anchor-id="clv-distribution">CLV Distribution</h4>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check distribution by CLV</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'EnrollmentYear'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, ci<span class="op">=</span><span class="va">None</span>, marker<span class="op">=</span><span class="st">'o'</span>, sort<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by Enrollment Year'</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Enrollment Year'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'City'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, ci<span class="op">=</span><span class="va">None</span>, marker<span class="op">=</span><span class="st">'o'</span>, sort<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by City'</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'City'</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>corr_coeff, _ <span class="op">=</span> pearsonr(cust_eda_loyalty_df[<span class="st">'Salary'</span>], cust_eda_loyalty_df[<span class="st">'CLV'</span>])</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'Salary'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, </span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">'s'</span>: <span class="dv">50</span>, <span class="st">'alpha'</span>: <span class="fl">0.9</span>, <span class="st">'edgecolor'</span>: <span class="st">'white'</span>}, </span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>}, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="ss">f'Correlation Coefficient: </span><span class="sc">{</span>corr_coeff<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, transform<span class="op">=</span>plt.gca().transAxes)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by Salary'</span>)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Salary'</span>)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>corr_coeff, _ <span class="op">=</span> pearsonr(cust_eda_loyalty_df[<span class="st">'TotalTotalFlights'</span>], cust_eda_loyalty_df[<span class="st">'CLV'</span>])</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'TotalTotalFlights'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, </span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">'s'</span>: <span class="dv">50</span>, <span class="st">'alpha'</span>: <span class="fl">0.9</span>, <span class="st">'edgecolor'</span>: <span class="st">'white'</span>}, </span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>}, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="ss">f'Correlation Coefficient: </span><span class="sc">{</span>corr_coeff<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, transform<span class="op">=</span>plt.gca().transAxes)</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by Total Flights Booked'</span>)</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Total Flights Booked'</span>)</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">6</span>)</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>corr_coeff, _ <span class="op">=</span> pearsonr(cust_eda_loyalty_df[<span class="st">'TotalDistance'</span>], cust_eda_loyalty_df[<span class="st">'CLV'</span>])</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'TotalDistance'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, </span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">'s'</span>: <span class="dv">50</span>, <span class="st">'alpha'</span>: <span class="fl">0.9</span>, <span class="st">'edgecolor'</span>: <span class="st">'white'</span>}, </span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>}, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="ss">f'Correlation Coefficient: </span><span class="sc">{</span>corr_coeff<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, transform<span class="op">=</span>plt.gca().transAxes)</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by Total Distance Travelled'</span>)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Total Distance Travelled'</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>corr_coeff, _ <span class="op">=</span> pearsonr(cust_eda_loyalty_df[<span class="st">'MonthsOfMembership'</span>], cust_eda_loyalty_df[<span class="st">'CLV'</span>])</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, </span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">'s'</span>: <span class="dv">50</span>, <span class="st">'alpha'</span>: <span class="fl">0.9</span>, <span class="st">'edgecolor'</span>: <span class="st">'white'</span>}, </span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>}, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="ss">f'Correlation Coefficient: </span><span class="sc">{</span>corr_coeff<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, transform<span class="op">=</span>plt.gca().transAxes)</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by Months of Membership'</span>)</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Months of Membership'</span>)</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">8</span>)</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>corr_coeff, _ <span class="op">=</span> pearsonr(cust_eda_loyalty_df[<span class="st">'TotalPointsAccumulated'</span>], cust_eda_loyalty_df[<span class="st">'CLV'</span>])</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>cust_eda_loyalty_df, x<span class="op">=</span><span class="st">'TotalPointsAccumulated'</span>, y<span class="op">=</span><span class="st">'CLV'</span>, </span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">'s'</span>: <span class="dv">50</span>, <span class="st">'alpha'</span>: <span class="fl">0.9</span>, <span class="st">'edgecolor'</span>: <span class="st">'white'</span>}, </span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>}, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="ss">f'Correlation Coefficient: </span><span class="sc">{</span>corr_coeff<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, transform<span class="op">=</span>plt.gca().transAxes)</span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Customer Lifetime Value by Total Points Accumulated'</span>)</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Total Points Accumulated'</span>)</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Customer Lifetime Value'</span>)</span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-40-output-1.png" width="1577" height="1959"></p>
</div>
</div>
</section>
</section>
<section id="potential-impact-of-2018-promotion" class="level3">
<h3 class="anchored" data-anchor-id="potential-impact-of-2018-promotion">Potential Impact of 2018 Promotion</h3>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>year_enrollment <span class="op">=</span> cust_eda_loyalty_df.groupby(<span class="st">'EnrollmentYear'</span>)[<span class="st">'EnrollmentYear'</span>].value_counts().reset_index()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>year_enrollment[<span class="st">'growth'</span>] <span class="op">=</span> year_enrollment[<span class="st">'count'</span>].pct_change()<span class="op">*</span><span class="dv">100</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>year_enrollment <span class="op">=</span> year_enrollment.fillna(<span class="dv">0</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>year_enrollment[<span class="st">'EnrollmentYear'</span>] <span class="op">=</span> year_enrollment[<span class="st">'EnrollmentYear'</span>].astype(<span class="st">'str'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>year_enrollment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">EnrollmentYear</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">growth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012</td>
<td>1686</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2013</td>
<td>2397</td>
<td>42.170819</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2014</td>
<td>2370</td>
<td>-1.126408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2015</td>
<td>2331</td>
<td>-1.645570</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2016</td>
<td>2456</td>
<td>5.362505</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2017</td>
<td>2487</td>
<td>1.262215</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2018</td>
<td>3010</td>
<td>21.029353</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">1</span>, ncols <span class="op">=</span> <span class="dv">3</span>, figsize <span class="op">=</span> (<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>sns.lineplot(year_enrollment[<span class="op">~</span>year_enrollment[<span class="st">'EnrollmentYear'</span>].isin([<span class="st">'2012'</span>,<span class="st">'2013'</span>])], x <span class="op">=</span> <span class="st">'EnrollmentYear'</span>, y<span class="op">=</span><span class="st">'growth'</span>,label<span class="op">=</span><span class="st">'growth'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Percentage change in # of customers'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(year_enrollment[<span class="op">~</span>year_enrollment[<span class="st">'EnrollmentYear'</span>].isin([<span class="st">'2012'</span>,<span class="st">'2013'</span>])][<span class="st">'EnrollmentYear'</span>], year_enrollment[<span class="op">~</span>year_enrollment[<span class="st">'EnrollmentYear'</span>].isin([<span class="st">'2012'</span>,<span class="st">'2013'</span>])][<span class="st">'growth'</span>]):</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].text(x, y, <span class="ss">f'</span><span class="sc">{</span>y<span class="sc">:.2f}</span><span class="ss">%'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>sns.lineplot(year_enrollment[<span class="op">~</span>year_enrollment[<span class="st">'EnrollmentYear'</span>].isin([<span class="st">'2012'</span>,<span class="st">'2013'</span>])], x <span class="op">=</span> <span class="st">'EnrollmentYear'</span>, y<span class="op">=</span><span class="st">'count'</span>,label<span class="op">=</span><span class="st">'count'</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Change in # of customers'</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(year_enrollment[<span class="op">~</span>year_enrollment[<span class="st">'EnrollmentYear'</span>].isin([<span class="st">'2012'</span>,<span class="st">'2013'</span>])][<span class="st">'EnrollmentYear'</span>], year_enrollment[<span class="op">~</span>year_enrollment[<span class="st">'EnrollmentYear'</span>].isin([<span class="st">'2012'</span>,<span class="st">'2013'</span>])][<span class="st">'count'</span>]):</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].text(x, y, <span class="ss">f'</span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>pivot_plot <span class="op">=</span> loyalty_df.groupby([<span class="st">'EnrollmentYear'</span>,<span class="st">'EnrollmentType'</span>]).size().reset_index().pivot(columns<span class="op">=</span><span class="st">'EnrollmentType'</span>,index <span class="op">=</span> <span class="st">'EnrollmentYear'</span>, values <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the columns</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>desired_order <span class="op">=</span> [<span class="st">'Standard'</span>, <span class="st">'2018 Promotion'</span>]</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>pivot_plot <span class="op">=</span> pivot_plot[desired_order]</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.countplot(loyalty_df[~loyalty_df['EnrollmentYear'].isin(['2012','2013'])], x = 'EnrollmentYear', hue = 'EnrollmentType', multiple='stack', hue_order=['2018 Promotion', 'Standard'])</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>pivot_plot.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax <span class="op">=</span> axs[<span class="dv">2</span>])</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">2</span>].set_title(<span class="st">'Change in # of customers'</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-42-output-1.png" width="1429" height="469"></p>
</div>
</div>
</section>
<section id="number-of-enrollment-and-cancellation" class="level3">
<h3 class="anchored" data-anchor-id="number-of-enrollment-and-cancellation">Number of Enrollment and Cancellation</h3>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>enrollments <span class="op">=</span> cust_eda_loyalty_df[<span class="st">'EnrollmentDate'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>cancellations <span class="op">=</span> cust_eda_loyalty_df[<span class="st">'CancellationDate'</span>].dropna().dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>plt.plot(enrollments.index.astype(<span class="bu">str</span>), enrollments.values, label<span class="op">=</span><span class="st">'Enrollments'</span>, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>plt.plot(cancellations.index.astype(<span class="bu">str</span>), cancellations.values, label<span class="op">=</span><span class="st">'Cancellations'</span>, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of Enrollments and Cancellations Over Time'</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date (Year-Month)'</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-43-output-1.png" width="1114" height="714"></p>
</div>
</div>
</section>
<section id="churn-customers" class="level3">
<h3 class="anchored" data-anchor-id="churn-customers">Churn Customers</h3>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get all churn customers</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>churn_monthsofmembership <span class="op">=</span> loyalty_df[loyalty_df[<span class="st">'ChurnIndicator'</span>].eq(<span class="dv">1</span>)][<span class="st">'MonthsOfMembership'</span>].value_counts().reset_index()<span class="op">\</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    .sort_values(by<span class="op">=</span><span class="st">'MonthsOfMembership'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of months of membership</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>churn_monthsofmembership, x<span class="op">=</span><span class="st">'MonthsOfMembership'</span>, y<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Months of membership'</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of customers'</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>plt.yticks(np.arange(<span class="dv">0</span>, <span class="dv">1400</span>, <span class="dv">200</span>))</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of all customers by months of membership'</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-44-output-1.png" width="661" height="468"></p>
</div>
</div>
</section>
</section>
<section id="hypothesis-testing" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing">Hypothesis Testing</h2>
<section id="kruskal-wallis-test-for-categorical-features-and-clv" class="level3">
<h3 class="anchored" data-anchor-id="kruskal-wallis-test-for-categorical-features-and-clv">Kruskal-Wallis Test for Categorical Features and CLV</h3>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 'continuous_var' is your continuous variable and 'nominal_var' is your nominal variable</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kruskal_wallis(df, cont_var, nom_var):</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    groups <span class="op">=</span> [df[df[<span class="ss">f'</span><span class="sc">{</span>nom_var<span class="sc">}</span><span class="ss">'</span>] <span class="op">==</span> category][<span class="ss">f'</span><span class="sc">{</span>cont_var<span class="sc">}</span><span class="ss">'</span>] <span class="cf">for</span> category <span class="kw">in</span> df[<span class="ss">f'</span><span class="sc">{</span>nom_var<span class="sc">}</span><span class="ss">'</span>].unique()]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    kruskal_result <span class="op">=</span> stats.kruskal(<span class="op">*</span>groups)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Kruskal-Wallis H-statistic for </span><span class="sc">{</span>nom_var<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>kruskal_result<span class="sc">.</span>statistic<span class="sc">}</span><span class="ss">, p-value: </span><span class="sc">{</span>kruskal_result<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="st">'MaritalStatus'</span>, <span class="st">'Education'</span>, <span class="st">'LoyaltyCard'</span>]:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    kruskal_wallis(loyalty_df, <span class="st">'CLV'</span>, i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kruskal-Wallis H-statistic for MaritalStatus: 32.67197728755935, p-value: 8.042114934653467e-08
Kruskal-Wallis H-statistic for Education: 82.73214822370325, p-value: 4.5915624634674436e-17
Kruskal-Wallis H-statistic for LoyaltyCard: 2204.896056033002, p-value: 0.0</code></pre>
</div>
</div>
</section>
</section>
<section id="encouraging-additional-expenditure-with-coupon-customer-segmentation" class="level2">
<h2 class="anchored" data-anchor-id="encouraging-additional-expenditure-with-coupon-customer-segmentation">Encouraging Additional Expenditure with Coupon &amp; Customer Segmentation</h2>
<p>Creating a new data frame to prevent making unnecessary changes to the main data frame.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>loyalty_df_cluster <span class="op">=</span> loyalty_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="defining-the-number-of-clusters" class="level3">
<h3 class="anchored" data-anchor-id="defining-the-number-of-clusters">Defining the Number of Clusters</h3>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting only the numerical features</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>cluster_features <span class="op">=</span> [<span class="st">'Salary'</span>,<span class="st">'CLV'</span>,<span class="st">'MonthsOfMembership'</span>,<span class="st">'TotalFlightsBooked'</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalFlightswithCompanions'</span>, <span class="st">'TotalTotalFlights'</span>, <span class="st">'TotalDistance'</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalPointsAccumulated'</span>, <span class="st">'TotalPointsRedeemed'</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalDollarCostPointsRedeemed'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select features for clustering</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> loyalty_df_cluster.loc[:,cluster_features]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit standard scaler</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>scaled_features <span class="op">=</span> scaler.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply PCA to reduce dimensionality to 2D</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>X_pca <span class="op">=</span> pca.fit_transform(scaled_features)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the components</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> pca.components_</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame to view component values in order to identify more important features for clustering</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>component_df <span class="op">=</span> pd.DataFrame(components, columns<span class="op">=</span>cluster_features, index<span class="op">=</span>[<span class="st">'PC1'</span>, <span class="st">'PC2'</span>, <span class="st">'PC3'</span>])</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>component_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Salary</th>
<th data-quarto-table-cell-role="th">CLV</th>
<th data-quarto-table-cell-role="th">MonthsOfMembership</th>
<th data-quarto-table-cell-role="th">TotalFlightsBooked</th>
<th data-quarto-table-cell-role="th">TotalFlightswithCompanions</th>
<th data-quarto-table-cell-role="th">TotalTotalFlights</th>
<th data-quarto-table-cell-role="th">TotalDistance</th>
<th data-quarto-table-cell-role="th">TotalPointsAccumulated</th>
<th data-quarto-table-cell-role="th">TotalPointsRedeemed</th>
<th data-quarto-table-cell-role="th">TotalDollarCostPointsRedeemed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">PC1</td>
<td>0.001779</td>
<td>-0.002746</td>
<td>0.256215</td>
<td>0.391827</td>
<td>0.370512</td>
<td>0.399315</td>
<td>0.395435</td>
<td>0.394964</td>
<td>0.292972</td>
<td>0.293061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PC2</td>
<td>-0.040422</td>
<td>0.018458</td>
<td>-0.217314</td>
<td>-0.201056</td>
<td>-0.061576</td>
<td>-0.175131</td>
<td>-0.183925</td>
<td>-0.183603</td>
<td>0.635855</td>
<td>0.635660</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PC3</td>
<td>0.713647</td>
<td>0.699477</td>
<td>0.027271</td>
<td>-0.008601</td>
<td>-0.012483</td>
<td>-0.009772</td>
<td>-0.005293</td>
<td>-0.000071</td>
<td>0.013082</td>
<td>0.013134</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a graph to determine the number of Principal Components and the features which contribute to its explained variance</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>explained_variance <span class="op">=</span> pca.explained_variance_ratio_</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(explained_variance) <span class="op">+</span> <span class="dv">1</span>), explained_variance.cumsum(), marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Principal Components'</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Cumulative Explained Variance'</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-52-output-1.png" width="597" height="429"></p>
</div>
</div>
<p>The first 2 Principal Components explain the majority of variance in the dataset. Only the features which are major contributors to the first 2 Princpal Components will be kept for clustering.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keeping only certain features based on their importance in the PCA</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>cluster_features <span class="op">=</span> [<span class="st">'TotalFlightsBooked'</span>, <span class="st">'TotalTotalFlights'</span>, <span class="st">'TotalDistance'</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalPointsAccumulated'</span>, <span class="st">'TotalPointsRedeemed'</span>,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalDollarCostPointsRedeemed'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select features for clustering</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> loyalty_df_cluster.loc[:,cluster_features]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit standard scaler</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>scaled_features <span class="op">=</span> scaler.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate within-cluster sum of squares (WCSS) for different values of k</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>wcss <span class="op">=</span> []</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>):</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>i, init<span class="op">=</span><span class="st">'k-means++'</span>, max_iter<span class="op">=</span><span class="dv">300</span>, n_init<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    kmeans.fit(scaled_features)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the elbow method curve</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>), wcss)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Elbow Method'</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Clusters'</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'WCSS'</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-56-output-1.png" width="619" height="449"></p>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate  silhouette coefficient for different values of k</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>silhoutte_coeff <span class="op">=</span> []</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>):</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>i, init<span class="op">=</span><span class="st">'k-means++'</span>, max_iter<span class="op">=</span><span class="dv">300</span>, n_init<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    kmeans.fit(scaled_features)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    silhoutte_coeff.append(silhouette_score(X,kmeans.labels_))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the elbow method curve</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>), silhoutte_coeff)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Elbow Method'</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Clusters'</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'silhouette'</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-57-output-1.png" width="589" height="449"></p>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of clusters</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>kmean <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, init<span class="op">=</span><span class="st">'k-means++'</span>, max_iter<span class="op">=</span><span class="dv">300</span>, n_init<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">2024</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>kmean.fit(scaled_features)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get labels</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="op">=</span> kmean.labels_</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster labels to the DF and adjust the cluster number so that they are more intuitive (cluster 0 will become cluster 1, for example)</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">=</span> cluster_labels<span class="op">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the count of points in each cluster</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>pd.concat([loyalty_df_cluster[<span class="st">'cluster'</span>].value_counts().sort_index().reset_index(),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>loyalty_df_cluster[<span class="st">'cluster'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).sort_index().reset_index()],axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">cluster</th>
<th data-quarto-table-cell-role="th">proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>4619</td>
<td>1</td>
<td>0.275975</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>4696</td>
<td>2</td>
<td>0.280576</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>7422</td>
<td>3</td>
<td>0.443449</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph by loyalty card</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))<span class="op">;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">3</span>):</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">2</span>):</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This determines the x_lim and y_lim by considering the values of the features</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>        cluster_0 <span class="op">=</span> loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">==</span> <span class="dv">1</span>][cluster_features[c]]</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>        cluster_1 <span class="op">=</span> loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">==</span> <span class="dv">2</span>][cluster_features[c]]</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        cluster_2 <span class="op">=</span> loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">==</span> <span class="dv">3</span>][cluster_features[c]]</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        cluster_3 <span class="op">=</span> loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">==</span> <span class="dv">4</span>][cluster_features[c]]</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        cluster_4 <span class="op">=</span> loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">==</span> <span class="dv">5</span>][cluster_features[c]]</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        cluster_5 <span class="op">=</span> loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>] <span class="op">==</span> <span class="dv">6</span>][cluster_features[c]]</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        min_c <span class="op">=</span> <span class="bu">min</span>(cluster_0.<span class="bu">min</span>(),cluster_1.<span class="bu">min</span>(),cluster_2.<span class="bu">min</span>(),cluster_3.<span class="bu">min</span>(),cluster_4.<span class="bu">min</span>(),cluster_5.<span class="bu">min</span>())</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        max_c <span class="op">=</span> <span class="bu">max</span>(cluster_0.<span class="bu">max</span>(),cluster_1.<span class="bu">max</span>(),cluster_2.<span class="bu">max</span>(),cluster_3.<span class="bu">max</span>(),cluster_4.<span class="bu">max</span>(),cluster_5.<span class="bu">max</span>())</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This automatically divides the feature into bins based on the entire dataset</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>        num_bin <span class="op">=</span> <span class="bu">list</span>(np.histogram(loyalty_df_cluster[cluster_features[c]],bins<span class="op">=</span><span class="dv">10</span>)[<span class="dv">1</span>])</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        sns.histplot(loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>]<span class="op">==</span><span class="dv">1</span>], x <span class="op">=</span> cluster_features[c], ax <span class="op">=</span> axs[i,j], stat <span class="op">=</span> <span class="st">'probability'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, bins <span class="op">=</span> num_bin, label <span class="op">=</span> <span class="st">'cluster_1'</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>        sns.histplot(loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>]<span class="op">==</span><span class="dv">2</span>], x <span class="op">=</span> cluster_features[c], ax <span class="op">=</span> axs[i,j], stat <span class="op">=</span> <span class="st">'probability'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, bins <span class="op">=</span> num_bin, label <span class="op">=</span> <span class="st">'cluster_2'</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>        sns.histplot(loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>]<span class="op">==</span><span class="dv">3</span>], x <span class="op">=</span> cluster_features[c], ax <span class="op">=</span> axs[i,j], stat <span class="op">=</span> <span class="st">'probability'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, bins <span class="op">=</span> num_bin, label <span class="op">=</span> <span class="st">'cluster_3'</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>        sns.histplot(loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>]<span class="op">==</span><span class="dv">4</span>], x <span class="op">=</span> cluster_features[c], ax <span class="op">=</span> axs[i,j], stat <span class="op">=</span> <span class="st">'probability'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, bins <span class="op">=</span> num_bin, label <span class="op">=</span> <span class="st">'cluster_4'</span>)</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>        sns.histplot(loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>]<span class="op">==</span><span class="dv">5</span>], x <span class="op">=</span> cluster_features[c], ax <span class="op">=</span> axs[i,j], stat <span class="op">=</span> <span class="st">'probability'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, bins <span class="op">=</span> num_bin, label <span class="op">=</span> <span class="st">'cluster_5'</span>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>        sns.histplot(loyalty_df_cluster[loyalty_df_cluster[<span class="st">'cluster'</span>]<span class="op">==</span><span class="dv">6</span>], x <span class="op">=</span> cluster_features[c], ax <span class="op">=</span> axs[i,j], stat <span class="op">=</span> <span class="st">'probability'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, bins <span class="op">=</span> num_bin, label <span class="op">=</span> <span class="st">'cluster_6'</span>)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>        axs[i, j].set_xlim(min_c,max_c)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>        axs[i, j].legend(title<span class="op">=</span><span class="st">'Cluster'</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>        c <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-60-output-1.png" width="1909" height="1908"></p>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numerical features for aggregation</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> [<span class="st">'Salary'</span>,<span class="st">'CLV'</span>,<span class="st">'MonthsOfMembership'</span>,<span class="st">'TotalFlightsBooked'</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalFlightswithCompanions'</span>, <span class="st">'TotalTotalFlights'</span>, <span class="st">'TotalDistance'</span>,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalPointsAccumulated'</span>, <span class="st">'TotalPointsRedeemed'</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'TotalDollarCostPointsRedeemed'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>median_clusters <span class="op">=</span> loyalty_df_cluster.groupby(<span class="st">'cluster'</span>)[num_features].median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to apply colors based on value positions</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> highlight_positions(s):</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    is_min <span class="op">=</span> s.isin(s.nsmallest(<span class="dv">1</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    is_max <span class="op">=</span> s.isin(s.nlargest(<span class="dv">1</span>))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    is_mid <span class="op">=</span> <span class="op">~</span>is_min <span class="op">&amp;</span> <span class="op">~</span>is_max</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [<span class="st">'background-color: #dddcdc'</span> <span class="cf">if</span> v <span class="cf">else</span> <span class="st">''</span> <span class="cf">for</span> v <span class="kw">in</span> is_min]</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [<span class="st">'background-color: #ffaf93'</span> <span class="cf">if</span> v <span class="cf">else</span> res <span class="cf">for</span> v, res <span class="kw">in</span> <span class="bu">zip</span>(is_max, result)]</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [<span class="st">'background-color: #93fff5'</span> <span class="cf">if</span> v <span class="cf">else</span> res <span class="cf">for</span> v, res <span class="kw">in</span> <span class="bu">zip</span>(is_mid, result)]</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>median_clusters <span class="op">=</span> median_clusters.style.<span class="bu">apply</span>(highlight_positions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>median_clusters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<style type="text/css">
#T_cad1c_row0_col0, #T_cad1c_row0_col1, #T_cad1c_row2_col2, #T_cad1c_row2_col3, #T_cad1c_row2_col4, #T_cad1c_row2_col5, #T_cad1c_row2_col6, #T_cad1c_row2_col7, #T_cad1c_row2_col8, #T_cad1c_row2_col9 {
  background-color: #93fff5;
}
#T_cad1c_row0_col2, #T_cad1c_row0_col3, #T_cad1c_row0_col4, #T_cad1c_row0_col5, #T_cad1c_row0_col6, #T_cad1c_row0_col7, #T_cad1c_row0_col8, #T_cad1c_row0_col9, #T_cad1c_row1_col1, #T_cad1c_row2_col0 {
  background-color: #ffaf93;
}
#T_cad1c_row1_col0, #T_cad1c_row1_col2, #T_cad1c_row1_col3, #T_cad1c_row1_col4, #T_cad1c_row1_col5, #T_cad1c_row1_col6, #T_cad1c_row1_col7, #T_cad1c_row1_col8, #T_cad1c_row1_col9, #T_cad1c_row2_col1 {
  background-color: #dddcdc;
}
</style>

<table id="T_cad1c" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_cad1c_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Salary</th>
<th id="T_cad1c_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">CLV</th>
<th id="T_cad1c_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">MonthsOfMembership</th>
<th id="T_cad1c_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">TotalFlightsBooked</th>
<th id="T_cad1c_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">TotalFlightswithCompanions</th>
<th id="T_cad1c_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">TotalTotalFlights</th>
<th id="T_cad1c_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">TotalDistance</th>
<th id="T_cad1c_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">TotalPointsAccumulated</th>
<th id="T_cad1c_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">TotalPointsRedeemed</th>
<th id="T_cad1c_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">TotalDollarCostPointsRedeemed</th>
</tr>
<tr class="odd">
<th class="index_name level0" data-quarto-table-cell-role="th">cluster</th>
<th class="blank col0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col1" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col2" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col3" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col4" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col5" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col6" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col7" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col8" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col9" data-quarto-table-cell-role="th">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_cad1c_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">1</td>
<td id="T_cad1c_row0_col0" class="data row0 col0">63853.000000</td>
<td id="T_cad1c_row0_col1" class="data row0 col1">5773.900000</td>
<td id="T_cad1c_row0_col2" class="data row0 col2">47.000000</td>
<td id="T_cad1c_row0_col3" class="data row0 col3">137.000000</td>
<td id="T_cad1c_row0_col4" class="data row0 col4">36.000000</td>
<td id="T_cad1c_row0_col5" class="data row0 col5">174.000000</td>
<td id="T_cad1c_row0_col6" class="data row0 col6">40788.000000</td>
<td id="T_cad1c_row0_col7" class="data row0 col7">4168.250000</td>
<td id="T_cad1c_row0_col8" class="data row0 col8">1554.000000</td>
<td id="T_cad1c_row0_col9" class="data row0 col9">126.000000</td>
</tr>
<tr class="even">
<td id="T_cad1c_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">2</td>
<td id="T_cad1c_row1_col0" class="data row1 col0">62866.000000</td>
<td id="T_cad1c_row1_col1" class="data row1 col1">5796.580000</td>
<td id="T_cad1c_row1_col2" class="data row1 col2">8.000000</td>
<td id="T_cad1c_row1_col3" class="data row1 col3">21.000000</td>
<td id="T_cad1c_row1_col4" class="data row1 col4">4.000000</td>
<td id="T_cad1c_row1_col5" class="data row1 col5">27.000000</td>
<td id="T_cad1c_row1_col6" class="data row1 col6">6152.000000</td>
<td id="T_cad1c_row1_col7" class="data row1 col7">616.500000</td>
<td id="T_cad1c_row1_col8" class="data row1 col8">0.000000</td>
<td id="T_cad1c_row1_col9" class="data row1 col9">0.000000</td>
</tr>
<tr class="odd">
<td id="T_cad1c_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">3</td>
<td id="T_cad1c_row2_col0" class="data row2 col0">63988.000000</td>
<td id="T_cad1c_row2_col1" class="data row2 col1">5769.755000</td>
<td id="T_cad1c_row2_col2" class="data row2 col2">43.000000</td>
<td id="T_cad1c_row2_col3" class="data row2 col3">122.000000</td>
<td id="T_cad1c_row2_col4" class="data row2 col4">28.000000</td>
<td id="T_cad1c_row2_col5" class="data row2 col5">151.000000</td>
<td id="T_cad1c_row2_col6" class="data row2 col6">35970.000000</td>
<td id="T_cad1c_row2_col7" class="data row2 col7">3675.200000</td>
<td id="T_cad1c_row2_col8" class="data row2 col8">523.000000</td>
<td id="T_cad1c_row2_col9" class="data row2 col9">42.000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">3</span>, ncols<span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">20</span>,<span class="dv">20</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">3</span>):</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">2</span>):</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i<span class="op">*</span>j <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>            sns.scatterplot(loyalty_df_cluster, x <span class="op">=</span> cluster_features[<span class="dv">0</span>], y <span class="op">=</span> cluster_features[<span class="op">-</span><span class="dv">1</span>], hue<span class="op">=</span><span class="st">'cluster'</span>, ax <span class="op">=</span> axs[i,j])</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:    </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>            sns.scatterplot(loyalty_df_cluster, x <span class="op">=</span> cluster_features[c], y <span class="op">=</span> cluster_features[c<span class="op">+</span><span class="dv">1</span>], hue<span class="op">=</span><span class="st">'cluster'</span>, ax <span class="op">=</span> axs[i,j])</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>        c <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="airline_files/figure-html/cell-66-output-1.png" width="1909" height="1908"></p>
</div>
</div>
</section>
<section id="determining-optimal-coupon-values-by-different-segmentation-methods" class="level3">
<h3 class="anchored" data-anchor-id="determining-optimal-coupon-values-by-different-segmentation-methods">Determining Optimal Coupon Values by different segmentation methods</h3>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric <span class="op">=</span> loyalty_df_cluster.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove all customers with 0 months of membership and 0 flight flown</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric <span class="op">=</span> loyalty_df_metric[loyalty_df_metric[<span class="st">'TotalDistance'</span>]<span class="op">!=</span><span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Customers' Average Monthly CLV</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric[<span class="st">'MonthsOfMembership'</span>] <span class="op">=</span> loyalty_df_metric[<span class="st">'MonthsOfMembership'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x<span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> x)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric[<span class="st">'AvgCLV'</span>] <span class="op">=</span> loyalty_df_metric[<span class="st">'CLV'</span>]<span class="op">/</span>loyalty_df_metric[<span class="st">'MonthsOfMembership'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Customers' Unit Revenue based on the Total Flights over the last 2 years</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric[<span class="st">'UnitRevenue'</span>] <span class="op">=</span> (loyalty_df_metric[<span class="st">'AvgCLV'</span>]<span class="op">*</span><span class="dv">24</span>)<span class="op">/</span>loyalty_df_metric[<span class="st">'TotalTotalFlights'</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric[<span class="st">'UnitRevenue'</span>] <span class="op">=</span> np.where(</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    (loyalty_df_metric[<span class="st">'MonthsOfMembership'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (loyalty_df_metric[<span class="st">'TotalTotalFlights'</span>]<span class="op">==</span><span class="dv">1</span>),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    loyalty_df_metric[<span class="st">'AvgCLV'</span>],</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    loyalty_df_metric[<span class="st">'UnitRevenue'</span>]</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="promotions-based-on-no-differentiation-one-large-customer-group" class="level4">
<h4 class="anchored" data-anchor-id="promotions-based-on-no-differentiation-one-large-customer-group">Promotions based on no differentiation (one large customer group)</h4>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function will determine the optimal customer index for the optimal coupon value</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> promo_ob3_v2(customers):  </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    marketing_cost <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> np.array(customers[<span class="st">'UnitRevenue'</span>].sort_values())</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l[np.argmax(np.add.accumulate(l) <span class="op">-</span> l<span class="op">*</span>marketing_cost<span class="op">*</span><span class="bu">len</span>(customers))]<span class="op">*</span>marketing_cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate profit and revenue based on no segmentation</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>m_cost <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>revenue_unsegmented <span class="op">=</span> <span class="bu">sum</span>(loyalty_df_metric[<span class="st">'UnitRevenue'</span>][loyalty_df_metric[<span class="st">'UnitRevenue'</span>]<span class="op">*</span>m_cost <span class="op">&lt;=</span> promo_ob3_v2(loyalty_df_metric)])</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>profit_unsegmented <span class="op">=</span> revenue_unsegmented <span class="op">-</span> promo_ob3_v2(loyalty_df_metric)<span class="op">*</span><span class="bu">len</span>(loyalty_df_metric)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Without customer segmentation:</span><span class="ch">\n</span><span class="ss">Profit is </span><span class="sc">{</span>profit_unsegmented<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Profit margin is </span><span class="sc">{</span>profit_unsegmented<span class="op">/</span>revenue_unsegmented<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total revenue is </span><span class="sc">{</span>revenue_unsegmented<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total cost is:'</span>, promo_ob3_v2(loyalty_df_metric)<span class="op">*</span><span class="bu">len</span>(loyalty_df_metric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Without customer segmentation:
Profit is 38505.985186105885
Profit margin is 0.17774345978361278
Total revenue is 216637.9861907919
Total cost is: 178132.00100468603</code></pre>
</div>
</div>
</section>
<section id="differentiated-promotions-based-on-categorical-characteristics" class="level4">
<h4 class="anchored" data-anchor-id="differentiated-promotions-based-on-categorical-characteristics">Differentiated promotions based on categorical characteristics</h4>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric[<span class="st">'target_customer'</span>] <span class="op">=</span> loyalty_df_metric[<span class="st">'Education'</span>] <span class="op">+</span> loyalty_df_metric[<span class="st">'LoyaltyCard'</span>] <span class="op">+</span> loyalty_df_metric[<span class="st">'MaritalStatus'</span>]</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>loyalty_df_metric[<span class="st">'target_customer_groups'</span>] <span class="op">=</span> loyalty_df_metric[<span class="st">'target_customer'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'target'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'BachelorAuroraMarried'</span> <span class="cf">else</span> <span class="st">'other'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(loyalty_df_metric[<span class="st">'target_customer'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate profit and revenue based on grouped segmentations</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> promo_ob3_v3(customers, group_label): </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    marketing_cost <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> np.array(customers[customers[<span class="st">'target_customer'</span>]<span class="op">==</span>group_label][<span class="st">'UnitRevenue'</span>].sort_values())</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l[np.argmax(np.add.accumulate(l) <span class="op">-</span> l<span class="op">*</span>marketing_cost<span class="op">*</span><span class="bu">len</span>(customers[customers[<span class="st">'target_customer'</span>]<span class="op">==</span>group_label]))]<span class="op">*</span>marketing_cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>profits <span class="op">=</span> []</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>revenue <span class="op">=</span> []</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> []</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> labels:</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    m_cost <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    revenue_segmented <span class="op">=</span> <span class="bu">sum</span>(loyalty_df_metric[<span class="st">'UnitRevenue'</span>][(loyalty_df_metric[<span class="st">'UnitRevenue'</span>]<span class="op">*</span>m_cost <span class="op">&lt;=</span> promo_ob3_v3(loyalty_df_metric,i)) <span class="op">&amp;</span> (loyalty_df_metric[<span class="st">'target_customer'</span>]<span class="op">==</span>i)])</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    profit_segmented <span class="op">=</span> revenue_segmented <span class="op">-</span> promo_ob3_v3(loyalty_df_metric,i)<span class="op">*</span><span class="bu">len</span>(loyalty_df_metric[loyalty_df_metric[<span class="st">'target_customer'</span>]<span class="op">==</span>i])</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    cost.append(promo_ob3_v3(loyalty_df_metric,i)<span class="op">*</span><span class="bu">len</span>(loyalty_df_metric[loyalty_df_metric[<span class="st">'target_customer'</span>]<span class="op">==</span>i]))</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    revenue.append(revenue_segmented)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    profits.append(profit_segmented)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"With customer segmentation:</span><span class="ch">\n</span><span class="ss">Profit is </span><span class="sc">{</span><span class="bu">sum</span>(profits)<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Profit margin is </span><span class="sc">{</span><span class="bu">sum</span>(profits)<span class="op">/</span><span class="bu">sum</span>(revenue)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total revenue is </span><span class="sc">{</span><span class="bu">sum</span>(revenue)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total cost is </span><span class="sc">{</span><span class="bu">sum</span>(cost)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>With customer segmentation:
Profit is 50930.07800271747
Profit margin is 0.2185888835412031
Total revenue is 232994.8219581686
Total cost is 182064.743955451</code></pre>
</div>
</div>
</section>
<section id="differentiated-promotions-based-on-k-means-clusters" class="level4">
<h4 class="anchored" data-anchor-id="differentiated-promotions-based-on-k-means-clusters">Differentiated promotions based on k-means clusters</h4>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate profit and revenue based on grouped segmentations</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> promo_ob3_v3(customers, cluster_num): </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    marketing_cost <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> np.array(customers[customers[<span class="st">'cluster'</span>]<span class="op">==</span>cluster_num][<span class="st">'UnitRevenue'</span>].sort_values())</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l[np.argmax(np.add.accumulate(l) <span class="op">-</span> l<span class="op">*</span>marketing_cost<span class="op">*</span><span class="bu">len</span>(customers[customers[<span class="st">'cluster'</span>]<span class="op">==</span>cluster_num]))]<span class="op">*</span>marketing_cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>profits <span class="op">=</span> []</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>revenue <span class="op">=</span> []</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> []</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> labels:</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    m_cost <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    revenue_segmented <span class="op">=</span> <span class="bu">sum</span>(loyalty_df_metric[<span class="st">'UnitRevenue'</span>][(loyalty_df_metric[<span class="st">'UnitRevenue'</span>]<span class="op">*</span>m_cost <span class="op">&lt;=</span> promo_ob3_v3(loyalty_df_metric,i)) <span class="op">&amp;</span> (loyalty_df_metric[<span class="st">'cluster'</span>]<span class="op">==</span>i)])</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    profit_segmented <span class="op">=</span> revenue_segmented <span class="op">-</span> promo_ob3_v3(loyalty_df_metric,i)<span class="op">*</span><span class="bu">len</span>(loyalty_df_metric[loyalty_df_metric[<span class="st">'cluster'</span>]<span class="op">==</span>i])</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    cost.append(promo_ob3_v3(loyalty_df_metric,i)<span class="op">*</span><span class="bu">len</span>(loyalty_df_metric[loyalty_df_metric[<span class="st">'cluster'</span>]<span class="op">==</span>i]))</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    revenue.append(revenue_segmented)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    profits.append(profit_segmented)</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"With customer segmentation:</span><span class="ch">\n</span><span class="ss">Profit is </span><span class="sc">{</span><span class="bu">sum</span>(profits)<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Profit margin is </span><span class="sc">{</span><span class="bu">sum</span>(profits)<span class="op">/</span><span class="bu">sum</span>(revenue)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total revenue is </span><span class="sc">{</span><span class="bu">sum</span>(revenue)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Total cost is </span><span class="sc">{</span><span class="bu">sum</span>(cost)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>With customer segmentation:
Profit is 185340.79182657355
Profit margin is 0.18142958634091688
Total revenue is 1021557.7049175833
Total cost is 836216.9130910097</code></pre>
</div>
</div>
</section>
<section id="crafting-a-new-metric-to-balance-raw-profit-and-profit-margin" class="level4">
<h4 class="anchored" data-anchor-id="crafting-a-new-metric-to-balance-raw-profit-and-profit-margin">Crafting a new metric to balance raw profit and profit margin</h4>
<p>Instead of just measuring solutions based on profit margin as a metric, we can create a new metric to add in the raw profit amount as an additional factor to add nuance to the metric. This can be caculated with the following formula:</p>
<p><span class="math inline">\(Margin Profit Score = log_{10}(Profit^2)*\frac{Profit}{Revenue}\)</span></p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.DataFrame({<span class="st">'method'</span>:[<span class="st">'m1'</span>,<span class="st">'m2'</span>,<span class="st">'m3'</span>],</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'profit'</span>:[<span class="dv">38505</span>,<span class="dv">50930</span>,<span class="dv">185147</span>],</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'revenue'</span>:[<span class="dv">216637</span>,<span class="dv">232994</span>,<span class="dv">1021297</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">'log'</span>] <span class="op">=</span> np.log(<span class="dv">50</span><span class="op">*</span>test_df[<span class="st">'profit'</span>])</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">'margin'</span>] <span class="op">=</span> (test_df[<span class="st">'profit'</span>]<span class="op">/</span>test_df[<span class="st">'revenue'</span>])</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">'margin_profit_score'</span>] <span class="op">=</span> (np.log10(test_df[<span class="st">'profit'</span>])<span class="op">**</span>weight)<span class="op">*</span>((test_df[<span class="st">'profit'</span>])<span class="op">/</span>test_df[<span class="st">'revenue'</span>])</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>test_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">method</th>
<th data-quarto-table-cell-role="th">profit</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">log</th>
<th data-quarto-table-cell-role="th">margin</th>
<th data-quarto-table-cell-role="th">margin_profit_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>m1</td>
<td>38505</td>
<td>216637</td>
<td>14.470566</td>
<td>0.177740</td>
<td>3.737327</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>m2</td>
<td>50930</td>
<td>232994</td>
<td>14.750230</td>
<td>0.218589</td>
<td>4.842978</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>m3</td>
<td>185147</td>
<td>1021297</td>
<td>16.040928</td>
<td>0.181286</td>
<td>5.030098</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Using this new Margin Profit Score, we see that the segmentation based on K-means clustering (m3) now become the most optimal solution because it has the highest amount of raw profit, but because of our logarithmic scaling, it is not that much larger than segmentation by categorical features because profit margin still plays a large role.</p>
<p>What we can learn from this slight departure is that a more customized metric might be better able to capture the appropriate mix of raw profit and profit margin that the airline desires.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>